% Tue Jul 13 2021

## ICFPC2021 に参加した

negainoido というチームで参加し, 凍結直前の最終スコアボードでは 12 位だった.

今のチーム構成で参加するのは4,5年目くらいなので大体誰が何を担当するかが決まってる.
なにせ三日間あるコンテストなので, 初日からゲーム AI (solver) を書き始めるのは二人程度いたら良くて,
二日目以降に人のをフォークして自分の AI を書くというスタイルでやってる.
ICFPC は自分たちでビジュアライザを作ったり, 解を管理するといったインフラの整備も同様に大切.
プログラムではなくて解を提出するというスタイルなので, 各問題に対する解を全部データベースに貯蔵しておいて,
裏で動いてるバッチがその中から最良のものを数分おきに提出させる仕組みが必要だった.
また, 解ければ何でも良いので, 手で解いてしまうのもバカにはできない手段だ.
今回の問題も根気（と, よく出来たツール）さえあれば手で解けてしまうような問題が含まれていた.
AIと人間が上手くお互いの欠点を補って作業する, みたいな, そういう用語があるよな.
今回の問題は特にそういった傾向が強く感じた.

というわけで私は初めから, ビジュアライザ兼エディタを初日から作り始めることにした.
結局私は最後まで AI は書かずにずっとエディタの機能追加と手で解くことを交互にやっていた.

## 問題概要

連結単純グラフが与えられる.
平面上にこれを配置せよ.

- 制約:
    - 多角形で表現される hole と呼ばれる領域内に収める
    - 各頂点の座標は格子点上にある
    - 各辺には長さが定められていて, 問題ごとにどれだけ元の長さから伸び縮みして良いかが決められている
        - その辺の元の長さを $d_0$, 問題で与えられる定数 $\epsilon$ とするとき,
        - 辺の長さ $d$ は $(1 - \epsilon) d_0 \leq d \leq (1 + \epsilon) d_0$ を満たす

$\epsilon$ は大抵十分小さいので, 隣接点から円を描いてその重なる点に置くしか無い.
しかもそれは整数座標である必要がある.
そして次で表される dislikes という値を最小化したい.

- dislikes
    - hole を表現する多角形について, その頂点からグラフへの距離の和
    - 頂点からグラフへの距離とは, グラフの各頂点への距離の最小値
    - $\mathrm{dislikes} = \sum_{v \in \mathrm{hole}} \min_{u \in \mathrm{graph}} d(u,v)$

雰囲気を伝えるためだけにわざと大雑把な説明に済ましたが,
実際には全て整数だけで計算可能なように, $\epsilon$ は 1e6 倍でスケールされていたり,
距離は平方ユークリッド距離（平方根をとらない）だったりする.

## エディタできた

ここ最近色々フロントエンドフレームワークを触っていて, Svelte というのが良さそうと教えてもらった.
今回のエディタも Svelte を使って web アプリとして作成した.
見た目は使い慣れてる Bulma という css フレームワークで作ったので適当にやってもまあまあ良さげになる.

![](https://i.imgur.com/clABGHk.gif)

![](https://i.imgur.com/asfn8TV.gif)

- 素朴な機能として
    - ビジュアライザ
        - 問題を選んで眺めることが出来る
        - 作った解を重ねて表示できる
        - 辺の長さが制約に対して伸び過ぎ/縮みすぎていることを色で表現する
    - 点を一つ選んで ドラッグ&ドロップ で移動
    - 全体/複数選択した点を平行移動/回転 (ただし浮動小数で）/フリップ などなど

![](https://i.imgur.com/UFEzrlM.gif)

- 少し高級な機能として
    - 辺の伸び縮に合わせて勝手に伸び縮させる
    - 裏のインフラとつなぐ
        - 現在の（自分たちのデータベース上の）最適解を読み込む
        - 提出する
    - 裏のソルバーとつなぐ（Web API として提供されている）
        - 複数選択した点を投げてそこだけ勝手に最適化してくれる

いくつかの問題は

- 正しく配置すれば dislikes がゼロにできる
- 出来上がりは（およそ）キレイな平面グラフになる

といった性質があり, 人間の直感と美的センスをうまく使って解くことができた.

### 元問題 (#68)

![](https://i.imgur.com/DWS4Ama.png)

### エディタによって得られた解

![](https://i.imgur.com/3SsnCLc.png)

とくに周囲から置いてくのが大事.

上の例のように初めに与えられるグラフはぐちゃぐちゃに折りたたまれているので, これを上手に「ほぐす」必要があった.
初めは, 頂点同士にいい感じに斥力を与えたり, エッジをバネのようにしたりなど物理シミュレーションをエディタに実装し,
それをなんとか使っていたのだが,
三日目にしてチームメンバーの autotaker さんが graphviz を使うことを思いつき dotsolver が生まれた.
graphviz は, 最強.
Svelte も最強.
