<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Deep Learning Face Representation from Predicting 10,000 Classes (DeepID)</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../resources/css/c.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header class="page-header">
    <a href='index.html'><img src="../resources/img/identicon.png" style="position:relative; top:0.4em; width:1.3em;border-radius:0.8em;" /> paper/</a>
</header>
<header>
<h1 class="title">Deep Learning Face Representation from Predicting 10,000 Classes (DeepID)</h1>
</header>
<ul>
<li>
original paper: <a href=http://mmlab.ie.cuhk.edu.hk/pdf/YiSun_CVPR14.pdf>http://mmlab.ie.cuhk.edu.hk/pdf/YiSun_CVPR14.pdf</a>
</li>
</ul>
<div class="is-pulled-right">
<p><a class='tag is-blue' href=index.html#距離学習>距離学習</a> <a class='tag is-blue' href=index.html#類似度学習>類似度学習</a> <a class='tag is-blue' href=index.html#顔認証>顔認証</a></p>
</div>
<h2 id="概要">概要</h2>
<p>顔認証 (Face verification) をする. すなわち２つの画像が与えられて、同一人物かどうかを判定するタスク. <a href="http://vis-www.cs.umass.edu/lfw/">Labeled Faces in the Wild (LFW)</a> というデータセットで 97.45% の Acc を達成.</p>
<h2 id="手法">手法</h2>
<p>顔画像 1 枚から、彼らが DeepID と呼ぶ特徴ベクトルに写す. 画像のペア (つまり２枚) が与えられた時、それぞれを特徴ベクトルに写し、 特徴ベクトル同士を比較することで顔認証を行う.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="344pt" height="98pt" viewBox="0.00 0.00 344.00 98.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 94)">
<title>
%3
</title>
<!-- FaceImage1 -->
<g id="node1" class="node">
<title>
FaceImage1
</title>
<polygon fill="none" stroke="black" points="83,-90 0,-90 0,-54 83,-54 83,-90"/> <text text-anchor="middle" x="41.5" y="-68.3" font-family="Times,serif" font-size="14.00">FaceImage1</text> </g> <!-- DeepID1 --> <g id="node2" class="node">
<title>
DeepID1
</title>
<polygon fill="none" stroke="black" points="234,-90 168,-90 168,-54 234,-54 234,-90"/> <text text-anchor="middle" x="201" y="-68.3" font-family="Times,serif" font-size="14.00">DeepID1</text> </g> <!-- FaceImage1&#45;&gt;DeepID1 --> <g id="edge1" class="edge">
<title>
FaceImage1-&gt;DeepID1
</title>
<path fill="none" stroke="black" d="M83.0602,-72C105.903,-72 134.401,-72 157.546,-72"/> <polygon fill="black" stroke="black" points="157.764,-75.5001 167.764,-72 157.764,-68.5001 157.764,-75.5001"/> <text text-anchor="middle" x="125.5" y="-75.8" font-family="Times,serif" font-size="14.00">ConvNet</text> </g> <!-- is&#45;same? --> <g id="node5" class="node">
<title>
is-same?
</title>
<polygon fill="none" stroke="black" points="336,-66 271,-66 271,-30 336,-30 336,-66"/> <text text-anchor="middle" x="303.5" y="-44.3" font-family="Times,serif" font-size="14.00">is-same?</text> </g> <!-- DeepID1&#45;&gt;is&#45;same? --> <g id="edge3" class="edge">
<title>
DeepID1-&gt;is-same?
</title>
<path fill="none" stroke="black" d="M234.075,-64.3403C242.59,-62.307 251.909,-60.0815 260.853,-57.9456"/> <polygon fill="black" stroke="black" points="261.816,-61.3142 270.729,-55.5871 260.19,-54.5056 261.816,-61.3142"/> </g> <!-- FaceImage2 --> <g id="node3" class="node">
<title>
FaceImage2
</title>
<polygon fill="none" stroke="black" points="83,-36 0,-36 0,-0 83,-0 83,-36"/> <text text-anchor="middle" x="41.5" y="-14.3" font-family="Times,serif" font-size="14.00">FaceImage2</text> </g> <!-- DeepID2 --> <g id="node4" class="node">
<title>
DeepID2
</title>
<polygon fill="none" stroke="black" points="234,-36 168,-36 168,-0 234,-0 234,-36"/> <text text-anchor="middle" x="201" y="-14.3" font-family="Times,serif" font-size="14.00">DeepID2</text> </g> <!-- FaceImage2&#45;&gt;DeepID2 --> <g id="edge2" class="edge">
<title>
FaceImage2-&gt;DeepID2
</title>
<path fill="none" stroke="black" d="M83.0602,-18C105.903,-18 134.401,-18 157.546,-18"/> <polygon fill="black" stroke="black" points="157.764,-21.5001 167.764,-18 157.764,-14.5001 157.764,-21.5001"/> <text text-anchor="middle" x="125.5" y="-21.8" font-family="Times,serif" font-size="14.00">ConvNet</text> </g> <!-- DeepID2&#45;&gt;is&#45;same? --> <g id="edge4" class="edge">
<title>
DeepID2-&gt;is-same?
</title>
<path fill="none" stroke="black" d="M234.075,-27.5747C242.681,-30.1436 252.109,-32.958 261.141,-35.6541"/> <polygon fill="black" stroke="black" points="260.146,-39.0095 270.729,-38.5162 262.148,-32.302 260.146,-39.0095"/> </g> </g>
</svg>
<h3 id="deepid-の学習">DeepID の学習</h3>
<p>一枚の画像を適当な ConvNet によって 160次元の特徴ベクトル (ひとまずこれを DeepID と呼ぶ) に写す. 画像には 10,000 クラス程度のラベルがついているので、これを予測する形で DeepID を鍛える.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="367pt" height="44pt" viewBox="0.00 0.00 367.00 44.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 40)">
<title>
%3
</title>
<!-- FaceImage -->
<g id="node1" class="node">
<title>
FaceImage
</title>
<polygon fill="none" stroke="black" points="77,-36 0,-36 0,-0 77,-0 77,-36"/> <text text-anchor="middle" x="38.5" y="-14.3" font-family="Times,serif" font-size="14.00">FaceImage</text> </g> <!-- DeepID --> <g id="node2" class="node">
<title>
DeepID
</title>
<polygon fill="none" stroke="black" points="221,-36 162,-36 162,-0 221,-0 221,-36"/> <text text-anchor="middle" x="191.5" y="-14.3" font-family="Times,serif" font-size="14.00">DeepID</text> </g> <!-- FaceImage&#45;&gt;DeepID --> <g id="edge1" class="edge">
<title>
FaceImage-&gt;DeepID
</title>
<path fill="none" stroke="black" d="M77.2142,-18C99.9398,-18 128.819,-18 151.732,-18"/> <polygon fill="black" stroke="black" points="151.796,-21.5001 161.795,-18 151.795,-14.5001 151.796,-21.5001"/> <text text-anchor="middle" x="119.5" y="-21.8" font-family="Times,serif" font-size="14.00">ConvNet</text> </g> <!-- Classes --> <g id="node3" class="node">
<title>
Classes
</title>
<polygon fill="none" stroke="black" points="359,-36 302,-36 302,-0 359,-0 359,-36"/> <text text-anchor="middle" x="330.5" y="-14.3" font-family="Times,serif" font-size="14.00">Classes</text> </g> <!-- DeepID&#45;&gt;Classes --> <g id="edge2" class="edge">
<title>
DeepID-&gt;Classes
</title>
<path fill="none" stroke="black" d="M221.22,-18C241.676,-18 269.375,-18 291.637,-18"/> <polygon fill="black" stroke="black" points="291.754,-21.5001 301.754,-18 291.754,-14.5001 291.754,-21.5001"/> <text text-anchor="middle" x="261.5" y="-21.8" font-family="Times,serif" font-size="14.00">softmax</text> </g> </g>
</svg>
<p>後述するが入力画像のサイズに依らず DeepID は 160 次元に固定している. これは LFW におけるクラスの予測に適当だという判断だと思う.</p>
<h3 id="パッチ">パッチ</h3>
<p>一枚の画像を一回読むだけでは限界がある. というわけで次のような改良を行う.</p>
<p>一枚の画像から複数のパッチを作る. パッチとは矩形の切り抜きのことであるが、 その切り取る箇所や切り取る大きさに関してバリエーションを持たせる.</p>
<p>ただしパッチの数 <span class="math inline">\(k\)</span> は予め決めておき、 <span class="math inline">\(i\)</span> 番目のパッチの作り方は予め定めておいてそれをずっと使う.</p>
<p>パッチの数だけ ConvNet を用意する. <span class="math inline">\(i\)</span> 番目のパッチは <span class="math inline">\(i\)</span> 番目の ConvNet で読む.</p>
<p>入力の大きさはパッチによって異なりうるが、出力は全て同じで 160次元である. これをパッチから生成した DeepID とする.</p>
<p>各 ConvNet 及び DeepID は先述した方法で鍛える.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="351pt" height="152pt" viewBox="0.00 0.00 351.00 152.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 148)">
<title>
%3
</title>
<!-- Patch1 -->
<g id="node1" class="node">
<title>
Patch1
</title>
<polygon fill="none" stroke="black" points="54,-144 0,-144 0,-108 54,-108 54,-144"/> <text text-anchor="middle" x="27" y="-122.3" font-family="Times,serif" font-size="14.00">Patch1</text> </g> <!-- DeepID1 --> <g id="node2" class="node">
<title>
DeepID1
</title>
<polygon fill="none" stroke="black" points="212,-144 146,-144 146,-108 212,-108 212,-144"/> <text text-anchor="middle" x="179" y="-122.3" font-family="Times,serif" font-size="14.00">DeepID1</text> </g> <!-- Patch1&#45;&gt;DeepID1 --> <g id="edge1" class="edge">
<title>
Patch1-&gt;DeepID1
</title>
<path fill="none" stroke="black" d="M54.128,-126C76.6547,-126 109.6,-126 135.853,-126"/> <polygon fill="black" stroke="black" points="135.913,-129.5 145.913,-126 135.913,-122.5 135.913,-129.5"/> <text text-anchor="middle" x="100" y="-129.8" font-family="Times,serif" font-size="14.00">ConvNet1</text> </g> <!-- DeepID --> <g id="node7" class="node">
<title>
DeepID
</title>
<polygon fill="none" stroke="black" points="343,-90 284,-90 284,-54 343,-54 343,-90"/> <text text-anchor="middle" x="313.5" y="-68.3" font-family="Times,serif" font-size="14.00">DeepID</text> </g> <!-- DeepID1&#45;&gt;DeepID --> <g id="edge4" class="edge">
<title>
DeepID1-&gt;DeepID
</title>
<path fill="none" stroke="black" d="M212.267,-112.881C228.406,-106.315 248.238,-98.2433 266,-91 268.816,-89.8516 271.728,-88.6634 274.657,-87.4677"/> <polygon fill="black" stroke="black" points="276.042,-90.683 283.976,-83.6621 273.395,-84.2025 276.042,-90.683"/> <text text-anchor="middle" x="248" y="-108.8" font-family="Times,serif" font-size="14.00">concat</text> </g> <!-- Patch2 --> <g id="node3" class="node">
<title>
Patch2
</title>
<polygon fill="none" stroke="black" points="54,-90 0,-90 0,-54 54,-54 54,-90"/> <text text-anchor="middle" x="27" y="-68.3" font-family="Times,serif" font-size="14.00">Patch2</text> </g> <!-- DeepID2 --> <g id="node4" class="node">
<title>
DeepID2
</title>
<polygon fill="none" stroke="black" points="212,-90 146,-90 146,-54 212,-54 212,-90"/> <text text-anchor="middle" x="179" y="-68.3" font-family="Times,serif" font-size="14.00">DeepID2</text> </g> <!-- Patch2&#45;&gt;DeepID2 --> <g id="edge2" class="edge">
<title>
Patch2-&gt;DeepID2
</title>
<path fill="none" stroke="black" d="M54.128,-72C76.6547,-72 109.6,-72 135.853,-72"/> <polygon fill="black" stroke="black" points="135.913,-75.5001 145.913,-72 135.913,-68.5001 135.913,-75.5001"/> <text text-anchor="middle" x="100" y="-75.8" font-family="Times,serif" font-size="14.00">ConvNet2</text> </g> <!-- DeepID2&#45;&gt;DeepID --> <g id="edge5" class="edge">
<title>
DeepID2-&gt;DeepID
</title>
<path fill="none" stroke="black" d="M212.075,-72C230.642,-72 254.142,-72 273.74,-72"/> <polygon fill="black" stroke="black" points="273.877,-75.5001 283.877,-72 273.877,-68.5001 273.877,-75.5001"/> <text text-anchor="middle" x="248" y="-75.8" font-family="Times,serif" font-size="14.00">concat</text> </g> <!-- Patch3 --> <g id="node5" class="node">
<title>
Patch3
</title>
<polygon fill="none" stroke="black" points="54,-36 0,-36 0,-0 54,-0 54,-36"/> <text text-anchor="middle" x="27" y="-14.3" font-family="Times,serif" font-size="14.00">Patch3</text> </g> <!-- DeepID3 --> <g id="node6" class="node">
<title>
DeepID3
</title>
<polygon fill="none" stroke="black" points="212,-36 146,-36 146,-0 212,-0 212,-36"/> <text text-anchor="middle" x="179" y="-14.3" font-family="Times,serif" font-size="14.00">DeepID3</text> </g> <!-- Patch3&#45;&gt;DeepID3 --> <g id="edge3" class="edge">
<title>
Patch3-&gt;DeepID3
</title>
<path fill="none" stroke="black" d="M54.128,-18C76.6547,-18 109.6,-18 135.853,-18"/> <polygon fill="black" stroke="black" points="135.913,-21.5001 145.913,-18 135.913,-14.5001 135.913,-21.5001"/> <text text-anchor="middle" x="100" y="-21.8" font-family="Times,serif" font-size="14.00">ConvNet3</text> </g> <!-- DeepID3&#45;&gt;DeepID --> <g id="edge6" class="edge">
<title>
DeepID3-&gt;DeepID
</title>
<path fill="none" stroke="black" d="M212.267,-31.1194C228.406,-37.6846 248.238,-45.7567 266,-53 268.816,-54.1484 271.728,-55.3366 274.657,-56.5323"/> <polygon fill="black" stroke="black" points="273.395,-59.7975 283.976,-60.3379 276.042,-53.317 273.395,-59.7975"/> <text text-anchor="middle" x="248" y="-56.8" font-family="Times,serif" font-size="14.00">concat</text> </g> </g>
</svg>
<p>最終的に得られた <span class="math inline">\(k\)</span> 個の DeepID を結合することで <span class="math inline">\(160k\)</span> 次元の特徴ベクトルを得る. これを改めて、入力画像から得た DeepID と呼ぶ.</p>
<h3 id="細かいこと">細かいこと</h3>
<p>一つのパッチは、入力画像を適切にリサイズした後に、39x31 (縦長) または 31x31 (正方形) で切り出す. とても小さい. 一つの ConvNet 自体も、たった 4層のCNNで出来てる. 畳み込みの直後に relu で活性化し、MaxPooling をする. BatchNormalization はしてないらしい.</p>
<p>パッチの枚数 <span class="math inline">\(k\)</span> はいくつか実験をしているが、基本的に多ければ多いほどよく <span class="math inline">\(k=60\)</span> での最高性能を報告している.</p>
<h2 id="verification">Verification</h2>
<p>与えられた２つの顔画像から先述した方法で各 DeepID を得る. 2つのID <span class="math inline">\(x_1, x_2\)</span> を見て、同一人物かどうか判定する. 一つは Joint Bayesian でやる方法と、適当な NN を組んで識別器を作る方法を提案していて、 前者のほうが 2% 程度よいということ.</p>
<h2 id="感想">感想</h2>
<p>DeepID を verification に使う際に予め DeepID から平均を引き算してから使っている. BatchNormalization を予め仕込んでおいたほうが良かったのではないだろうか.</p>
<!--

  HTML として pandoc -B で include する.

  <H2> を列挙してそれらにリンクを貼った toc を id='toc' に埋め込む.
  markdown で書いてるだろうから例として次のような段落を書けばよい.

```
## INDEX
<div id=toc></div>
```

  used in
  - /memo/gnuplot
  - /memo/linux
  - /memo/imagemagick

-->
<script>
(function() {
  var sections = document.getElementsByTagName('h2');
  var i;
  var OL = document.createElement('ol');
  for (i=0; i < sections.length; ++i) {
    var LI = document.createElement('li');
    var A = document.createElement('a');
    A.innerHTML = sections[i].innerHTML;
    if (A.innerHTML.toUpperCase() == 'INDEX') continue;
    A.href = '#' + i;
    LI.appendChild(A);
    OL.appendChild(LI);

    var PREF = document.createElement('a');
    PREF.name = i;
    sections[i].appendChild(PREF);
  }

  var done = false;
  function work() {
    if (done) return;
    if ( document.getElementById('toc') === null) return; // no toc element
    document.getElementById('toc').appendChild(OL);
    done = true;
  };

  window.onload = work;
  setTimeout(work,800);
}());
</script>
</body>
</html>
