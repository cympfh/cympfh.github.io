<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Sun May 22 10:30:45 JST 2016</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="../../../resources/css/c.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<a href="../../">ğŸ”™ Back to Top</a>
<header>
<h1 class="title">Sun May 22 10:30:45 JST 2016</h1>
</header>
<h2 id="chainer-ã®å‹‰å¼·">chainer ã®å‹‰å¼·</h2>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">wget</span> https://github.com/pfnet/chainer/archive/v1.8.2.tar.gz <span class="co"># the latest url</span>
<span class="fu">tar</span> xf v1.8.2.tar.gz
<span class="bu">cd</span> chainer-v1.8.2/docs
<span class="fu">make</span> html
<span class="ex">open</span> html/build/index.html</code></pre></div>
<ul>
<li>&quot;Intdoduction to Chainer&quot; ã‚’è‰¯ãèª­ã‚€
<ul>
<li>Chainer ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå°‘ã—å¤ã„ã¨ã™ãæ›¸ãæ–¹ãŒå¤‰ã‚ã‚‹ã®ã§æ³¨æ„</li>
<li>ãã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® docs ã‚’ä¿¡ç”¨ã™ã‚‹ã“ã¨</li>
<li>ä¸€èˆ¬äººã®æ›¸ã„ãŸãƒ–ãƒ­ã‚°ã®ã‚³ãƒ¼ãƒ‰ãªã‚“ã¦èª­ã‚“ã§ã‚‚ã—ã‚‡ã†ãŒãªã„
<ul>
<li>ã‚³ãƒ³ã‚»ãƒ—ãƒˆã ã‘ã‚’å‚è€ƒã«ã™ã‚‹ã“ã¨</li>
</ul></li>
</ul></li>
</ul>
<p>ä»¥ä¸Š</p>
<p>ä»¥ä¸‹ã€(ç§ãŒè©°ã¾ã£ãŸ) æœ€ä½é™ã®å¿…è¦çŸ¥è­˜</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> numpy <span class="im">as</span> np
<span class="im">import</span> chainer
<span class="im">from</span> chainer <span class="im">import</span> cuda, Function, gradient_check, Variable, optimizers, serializers, utils
<span class="im">from</span> chainer <span class="im">import</span> Link, Chain, ChainList
<span class="im">import</span> chainer.functions <span class="im">as</span> F
<span class="im">import</span> chainer.links <span class="im">as</span> L</code></pre></div>
<p>ã‚’å‰æã¨ã™ã‚‹.</p>
<h3 id="ç’°å¢ƒ">ç’°å¢ƒ</h3>
<ul>
<li>Python 3.x</li>
<li>chainer ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æœ€æ–°</li>
<li><code>pickle</code> ã§ã¯ãªã <code>Chainer.serializer</code> ã§ãƒ¢ãƒ‡ãƒ«ã‚’ä¿å­˜</li>
</ul>
<h3 id="å‹">å‹</h3>
<ul>
<li>Python ã®ãƒªã‚¹ãƒˆ
<ul>
<li>list</li>
</ul></li>
<li><code>np.array</code>
<ul>
<li><code>np.array(list)</code></li>
<li>ãƒ™ã‚¯ãƒˆãƒ«ã‚‚è¡Œåˆ—ã‚‚ã“ã‚Œã§è¡¨ç¾ã™ã‚‹
<ul>
<li><code>.reshape((n, m))</code> ã§ <span class="math inline">\(n \times m\)</span> è¡Œåˆ—ã«å¤‰æ›ã™ã‚‹</li>
<li><code>.reshape((n, ))</code> ã§ãƒ™ã‚¯ãƒˆãƒ«ã«å¤‰æ›ã™ã‚‹</li>
</ul></li>
<li><code>[]</code> ã§è¦ç´ ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
</ul></li>
<li><code>Variable</code>
<ul>
<li>Chainer ãŒæ‰±ã„ã‚„ã™ã„ã‚ˆã†ã« <code>np.array</code> ã‚’ã•ã‚‰ã«åŒ…ã‚“ã ã‚‚ã®</li>
<li>ç›´æ¥ <code>Variable</code> ã«å¯¾ã™ã‚‹è«¸ã€…ã®æ¼”ç®—ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹</li>
<li><code>.data</code> ã§ä¸­ã® <code>np.array</code> ã«ã‚¢ã‚¯ã‚»ã‚¹
<ul>
<li>å†…éƒ¨çš„ã« <code>.grad</code> ã¨ã‹ã„ã‚ã„ã‚å®Ÿã¯æŒã£ã¦ã¦æœ€é©åŒ–ã®éš›ã«ç”¨ã„ã‚‰ã‚Œã‚‹</li>
</ul></li>
</ul></li>
</ul>
<h2 id="ç·šå½¢åˆ†é¡å™¨">ç·šå½¢åˆ†é¡å™¨</h2>
<ul>
<li>å…¥åŠ› <span class="math inline">\(x \in \mathbb{R}^2\)</span>
<ul>
<li><code>np.array(list, dtype=np.float32).reshape((1, 2))</code> ã¨è¡¨ç¾ã™ã‚‹
<ul>
<li><code>list</code> ã¯é©å½“ãªæ•°ã® Pythonãƒªã‚¹ãƒˆ</li>
</ul></li>
<li>ã“ã‚Œã‚’ã•ã‚‰ã« <code>Chainer.Variable</code> ã§åŒ…ã‚€</li>
</ul></li>
<li>å‡ºåŠ› <span class="math inline">\(y \in \mathcal{Y}\)</span> where <span class="math inline">\(\#\mathcal{Y} = 2\)</span>
<ul>
<li><span class="math inline">\(\mathcal{Y} = \{ 0,1, \cdots, \#\mathcal{Y}-1 \}\)</span> ã‚’ä»®å®šã›ã‚ˆ</li>
<li><code>np.array([ y ], dtype=np.int32).reshape((1,))</code>
<ul>
<li><code>y</code> ã¯ <span class="math inline">\(y \in \mathcal{Y}\)</span> ã® <span class="math inline">\(y\)</span></li>
</ul></li>
<li>ã“ã‚Œã‚’ã•ã‚‰ã« <code>Chainer.Variable</code> ã§åŒ…ã‚€</li>
</ul></li>
</ul>
<h3 id="ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯-chainer.chain">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (Chainer.Chain)</h3>
<p>&quot;Core Concept&quot; ã«ã‚‚ã‚ã‚‹ã‚ˆã†ã«ã€ã¾ãšã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å®šç¾©ã™ã‚‹</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="kw">class</span> MyNet(Chain):
    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):
        <span class="bu">super</span>(MyNet, <span class="va">self</span>).<span class="fu">__init__</span>(
            l <span class="op">=</span> L.Linear(<span class="dv">2</span>, <span class="dv">2</span>) <span class="co"># (dim(x), #Y)</span>
        )
    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, x):
        y <span class="op">=</span> <span class="va">self</span>.l(x)
        <span class="cf">return</span> y</code></pre></div>
<p><code>l = L.Linear(n, m)</code> ã¨ã¯ <span class="math inline">\(n \times m\)</span> è¡Œåˆ— <span class="math inline">\(W\)</span> ã¨é•·ã• <span class="math inline">\(m\)</span> ã®ãƒã‚¤ã‚¢ã‚¹ãªãƒ™ã‚¯ãƒˆãƒ« <span class="math inline">\(b\)</span> ã«ã‚ˆã‚‹ç·šå½¢åˆ†é¡ï¼‘ã¤ã‚’è¡¨ç¾ã™ã‚‹ (<span class="math inline">\(y = Wx+b\)</span>). <span class="math inline">\(b\)</span> ã¯æ˜ç¤ºã—ãªã‘ã‚Œã°å§‹ã‚ã‚¼ãƒ­ãƒ™ã‚¯ãƒˆãƒ«ã§ã‚ã‚‹ãŒã€<span class="math inline">\(W\)</span> ã¯å§‹ã‚ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°ã«ã‚ˆã£ã¦åˆæœŸåŒ–ã•ã‚Œã‚‹ã£ã½ã„.</p>
<h3 id="ãƒ¢ãƒ‡ãƒ«æœ€é©åŒ–ã‚½ãƒ«ãƒ">ãƒ¢ãƒ‡ãƒ«ã€æœ€é©åŒ–ã‚½ãƒ«ãƒ</h3>
<pre><code>model = L.Classifier(MyNet())
opt = optimizers.SGD()
opt.setup(model)</code></pre>
<p>ã“ã®æ™‚ã‹ã‚‰æˆ‘ã€…ã¯ <code>model</code> ãŠã‚ˆã³ <code>opt</code> ã®ã¿ã‚’æ“ä½œã™ã‚Œã°ã‚ˆã„. <code>Chainer.optimizers</code> ã¯ä¸­ã«æ§˜ã€…ãªæœ€é©åŒ–ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ã‚‚ã£ã¦ãŠã‚Šã€ ä¾‹ãˆã°ã“ã“ã§ã¯ <code>SGD</code> ã‚’é¸æŠã—ã¦ã„ã‚‹. <code>opt.setup</code> ã¯ã‚ˆãã‚ã‹ã‚‰ã‚“ã‘ã©ã€ä¸æ€è­°ãªã“ã¨ã« <code>model</code> ã®ãŸã‚ã®æœ€é©åŒ–ã‚’è¡Œã†ãŸã‚ã®æ§‹é€ ã‚’ãã“ã§ã‚»ãƒƒãƒˆã™ã‚‹. é©å½“ãªæ•°å€¤å¾®åˆ†ã‚’è¡Œã†ã®ã ã‚ã†ã‹.</p>
<h3 id="äººå·¥ãƒ‡ãƒ¼ã‚¿">äººå·¥ãƒ‡ãƒ¼ã‚¿</h3>
<ul>
<li><span class="math inline">\(x = [ x_0, x_1 ]\)</span>
<ul>
<li><span class="math inline">\(x_0 \in_u [0,1]\)</span></li>
<li><span class="math inline">\(x_1 \in_u [0,1]\)</span></li>
</ul></li>
<li><span class="math inline">\(\mathcal{Y} = \{0,1\}\)</span>
<ul>
<li><span class="math inline">\(y = 0\)</span> when <span class="math inline">\(x_0+x_1&lt;1\)</span></li>
<li><span class="math inline">\(y = 1\)</span> otherwise</li>
</ul></li>
</ul>
<h3 id="è¨“ç·´">è¨“ç·´</h3>
<pre><code>    x = Variable(
            np.array([x0, x1], dtype=np.float32)
            .reshape((1, 2))
            )
    t = Variable(
            np.array([ y ], dtype=np.int32)
            .reshape((1,))
            )
    opt.update(model, x, t)</code></pre>
<p>ã“ã‚Œã‚’é©å½“ã«ãƒ«ãƒ¼ãƒ—ã§ã‚„ã‚‹.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> sys, random
<span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1000</span>):
    x0 <span class="op">=</span> random.random()
    x1 <span class="op">=</span> random.random()
    y <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> x0<span class="op">+</span>x1<span class="op">&lt;</span><span class="fl">1.0</span> <span class="cf">else</span> <span class="dv">1</span>
    <span class="co"># ä¸Šã®ã‚³ãƒ¼ãƒ‰</span></code></pre></div>
<p>ã“ã‚“ãªæ„Ÿã˜</p>
<h3 id="ãƒ†ã‚¹ãƒˆ">ãƒ†ã‚¹ãƒˆ</h3>
<p>å®Ÿéš›ã«äºˆæ¸¬ã—ã¦ã¿ã‚‹ã«ã¯ <code>model.predictor</code> ã‚’ä½¿ã†.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">x <span class="op">=</span> Variable(
        np.array([x0, x1], dtype<span class="op">=</span>np.float32)
        .reshape((<span class="dv">1</span>, <span class="dv">2</span>))
        )</code></pre></div>
<p>ã«ã¤ã„ã¦ã€<code>model.predictor(x)</code> ã¯ã‚„ã¯ã‚Š <code>Variable</code> ãªã®ã ãŒã€ ãã® <code>.data</code> ã‚’ã¿ã‚‹ã¨ã€ç¢ºä¿¡åº¦ (confidence) ã‚’é…åˆ—ã«ãªã£ã¦ã„ã‚‹. <code>y</code> ç•ªç›®ã®è¦ç´ ãŒ <span class="math inline">\(y (\in \mathcal{Y})\)</span> ã®ç¢ºä¿¡åº¦ã«å¯¾å¿œã—ã¦ã„ã‚‹.</p>
<p>æœ€ã‚‚å¤§ãã„æ•°ãŒå…¥ã£ã¦ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é¸ã¹ã°ã€æœ€å°¤ã«ãªã‚‹. <code>np.argmax</code> ã§ã“ã®æ“ä½œã¯å®Ÿç¾ã§ãã‚‹. æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«.</p>
<p>è¨“ç·´ã—ãŸã®ã¡ã€ ç¶²ç¾…çš„ã«</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">101</span>):
    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">101</span>):
        x0 <span class="op">=</span> i <span class="op">/</span> <span class="fl">100.0</span>
        x1 <span class="op">=</span> j <span class="op">/</span> <span class="fl">100.0</span>
        y <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> x0<span class="op">+</span>x1<span class="op">&lt;</span><span class="fl">1.0</span> <span class="cf">else</span> <span class="dv">1</span></code></pre></div>
<p>ã«ã¤ã„ã¦ã€å®Ÿéš›ã«äºˆæ¸¬ã—ã¦ã¿ã¦ã€ç­”ãˆ (<code>y</code>) ã¨ã®ä¸€è‡´åº¦ (Accuracy) ã‚’å›³ã‚‹ã“ã¨ã«ã™ã‚‹.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">correct <span class="op">=</span> <span class="dv">0</span>
wrong <span class="op">=</span> <span class="dv">0</span>

<span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">101</span>):
    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">101</span>):
        x0 <span class="op">=</span> i <span class="op">/</span> <span class="fl">100.0</span>
        x1 <span class="op">=</span> j <span class="op">/</span> <span class="fl">100.0</span>
        y <span class="op">=</span> <span class="dv">0</span> <span class="cf">if</span> x0<span class="op">+</span>x1<span class="op">&lt;</span><span class="fl">1.0</span> <span class="cf">else</span> <span class="dv">1</span>
        x <span class="op">=</span> Variable(
                np.array([x0, x1], dtype<span class="op">=</span>np.float32)
                .reshape((<span class="dv">1</span>, <span class="dv">2</span>))
                )
        y2 <span class="op">=</span> np.argmax(model.predictor(x).data)

        <span class="cf">if</span> y <span class="op">==</span> y2:
            correct <span class="op">+=</span> <span class="dv">1</span>
        <span class="cf">else</span>:
            wrong <span class="op">+=</span> <span class="dv">1</span>

<span class="bu">print</span>(<span class="st">&quot;Ac </span><span class="sc">{}</span><span class="st">&quot;</span>.<span class="bu">format</span>( correct <span class="op">/</span> (correct <span class="op">+</span> wrong) ))</code></pre></div>
<h3 id="çµæœ">çµæœ</h3>
<ul>
<li>1000 å›ã®è¨“ç·´ã§ã¯ <code>Ac 0.7490442113518283</code></li>
<li>10000 å›ã®è¨“ç·´ã§ã€ã‚ˆã†ã‚„ã <code>Ac 0.9708852073326144</code></li>
<li><code>.SGD()</code> ã®ä»£ã‚ã‚Šã« <code>.AdaDelta()</code> ã‚’ä½¿ã†ã¨ 1000 å›ã®ã¾ã¾ã§ã‚‚ <code>Ac 0.8820703852563474</code></li>
</ul>
<h2 id="of-k-è¡¨ç¾">1-of-k è¡¨ç¾</h2>
<p>ç›´æ¥ã®å…¥åŠ›ãŒãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ç©ºé–“ä¸Šã®ç‚¹ã§ãªãã€æ•´æ•°å‹ã§è¡¨ç¾ã•ã‚ŒãŸIDã§ã‚ã‚‹ã“ã¨ãŒã‚ã‚‹. ä¾‹ãˆã°å…¥åŠ›ãŒ <span class="math inline">\(n\)</span> é€šã‚Šã®ãƒ©ãƒ™ãƒ«ã§ã‚ã‚‹å ´åˆ. ãƒ©ãƒ™ãƒ«åŒå£«ã«å¾“å±é–¢ä¿‚ãŒãªã„ã®ãªã‚‰ã°ã€ã“ã‚Œã‚‰ã‚’ä¸€ã¤ã®å®Ÿæ•°ã«å¤‰æ›ã™ã‚‹ã“ã¨ã¯é›£ã—ã„. ã“ã†ã„ã£ãŸã‚‚ã®ã¯ 1-of-k ãƒ™ã‚¯ãƒˆãƒ«ã¨ã„ã£ãŸè¡¨ç¾æ–¹æ³•ãŒå–ã‚‰ã‚Œã‚‹. ã“ã‚Œã¯ã€ <span class="math inline">\(n \leq 2^k\)</span> ãªã‚‹æœ€å°ã®è‡ªç„¶æ•°ã‚’ <span class="math inline">\(k\)</span> ã¨ã™ã‚‹ã¨ãã€ ãƒ©ãƒ™ãƒ«ä¸€ã¤ã‚’ <span class="math inline">\(k\)</span> æ¬¡å…ƒã®ãƒ™ã‚¯ãƒˆãƒ«ã«å¤‰æ›ã™ã‚‹. æ‰‹é †ã¯æ¬¡ã®é€šã‚Šã§ã‚ã‚‹.</p>
<ul>
<li>ãƒ©ãƒ™ãƒ«ã®IDã‚’ <span class="math inline">\(i \in \{ 0,1, \ldots, n-1 \}\)</span> ã¨ã™ã‚‹</li>
<li><span class="math inline">\(k\)</span> æ¬¡å…ƒã®ã‚¼ãƒ­ãƒ™ã‚¯ãƒˆãƒ« <span class="math inline">\(v = [ 0,0,\ldots,0 ]\)</span> ã¨ã™ã‚‹</li>
<li>IDã«ã‚ˆã£ã¦ <span class="math inline">\(v_i = 1\)</span> ã§ä¸Šæ›¸ãã™ã‚‹</li>
<li><span class="math inline">\(v\)</span> ã‚’ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¾ã™ã‚‹ãƒ™ã‚¯ãƒˆãƒ«ã¨ã™ã‚‹</li>
</ul>
<p>æ¬¡å…ƒã¯ <span class="math inline">\(k\)</span> ã«å¢—ãˆã‚‹ãŒã€ç•°ãªã‚‹ãƒ©ãƒ™ãƒ«ã¯ç·šå½¢ç‹¬ç«‹ãªç•°ãªã‚‹ãƒ™ã‚¯ãƒˆãƒ«ã§è¡¨ç¾ã§ãã‚‹.</p>
<h3 id="l.embedid"><code>L.EmbedID</code></h3>
<p><code>L.EmbedID</code> é–¢æ•°ã¯ã€é›£ã—ã„ã“ã¨ã‚’è€ƒãˆãªãã¦ã‚‚ 1-of-k è¡¨ç¾çš„ãªã“ã¨ã‚’ã™ã‚‹. <code>L.EmbedID(n, k)</code> ã«ã‚ˆã£ã¦ <span class="math inline">\(n\)</span> å€‹ã®IDåˆ—ã‚’ <span class="math inline">\(k\)</span> ã®é•·ã•ã®ãƒ™ã‚¯ãƒˆãƒ«ã«ã™ã‚‹. é©åº¦ã«å¤§ãã„ <span class="math inline">\(k\)</span> ã‚’è¨­å®šã™ã‚Œã°è‰¯ã„ (æ€è€ƒåœæ­¢).</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="kw">class</span> MyNet(Chain):
    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):
        <span class="bu">super</span>(MyNet, <span class="va">self</span>).<span class="fu">__init__</span>(
            embed <span class="op">=</span> L.EmbedID(<span class="dv">1</span>, <span class="dv">10</span>) <span class="co"># k=10</span>
            l <span class="op">=</span> L.Linear(<span class="dv">10</span>, <span class="dv">2</span>) <span class="co"># (k, #Y)</span>
        )
    <span class="kw">def</span> <span class="fu">__call__</span>(<span class="va">self</span>, x):
        x <span class="op">=</span> <span class="va">self</span>.embed(x) <span class="co"># ID(x) -&gt; k-vector(x)</span>
        y <span class="op">=</span> <span class="va">self</span>.l(x) <span class="co"># y = Wx+b</span>
        <span class="cf">return</span> y</code></pre></div>
<p><code>__call__</code> é–¢æ•°ã«ã‚ˆã£ã¦ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¨ˆç®—æ‰‹é †ã‚’å®šç¾©ã™ã‚‹. å…¥åŠ› <code>x</code> ã¯ãƒ©ãƒ™ãƒ«ID (<code>np.int32</code>) ä¸€ã¤ã ã¨ã™ã‚‹. ã“ã‚Œã‚’é•·ã• <span class="math inline">\(k=10\)</span> ã®ãƒ™ã‚¯ãƒˆãƒ«ã«å¤‰æ›ã—ã¦ã‹ã‚‰ã€å…ˆã»ã©ã¨åŒã˜ç·šå½¢åˆ†é¡ã«æŠ•ã’ã‚‹.</p>
<p>ã¯ã˜ã‚ã® <span class="math inline">\(x\)</span> ã‚’ <span class="math inline">\(\mathbb{R}^2\)</span> ã‹ã‚‰ ID ã«ã—ãŸéƒ½åˆä¸Šã€ã‚³ãƒ¼ãƒ‰ã®ä¸Šã® <code>x</code> ã®è¡¨ç¾ãŒã¡ã‚‡ã£ã¨ã ã‘å¤‰ã‚ã‚‹.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">  <span class="bu">id</span> <span class="op">=</span> <span class="dv">1</span>
  x <span class="op">=</span> Variable( xp.array([ <span class="bu">id</span> ]).astype(xp.int32).reshape((<span class="dv">1</span>,<span class="dv">1</span>)) )
  model.predictor(x).data</code></pre></div>
<p>ã“ã‚“ãªé¢¨ã«ä½¿ã†.</p>
<!--

  HTML ã¨ã—ã¦ pandoc -B ã§ include ã™ã‚‹.

  <H2> ã‚’åˆ—æŒ™ã—ã¦ãã‚Œã‚‰ã«ãƒªãƒ³ã‚¯ã‚’è²¼ã£ãŸ toc ã‚’ id='toc' ã«åŸ‹ã‚è¾¼ã‚€.
  markdown ã§æ›¸ã„ã¦ã‚‹ã ã‚ã†ã‹ã‚‰ä¾‹ã¨ã—ã¦æ¬¡ã®ã‚ˆã†ãªæ®µè½ã‚’æ›¸ã‘ã°ã‚ˆã„.

```
## INDEX
<div id=toc></div>
```

  used in
  - /memo/gnuplot
  - /memo/linux
  - /memo/imagemagick

-->
<script>
(function() {
  var sections = document.getElementsByTagName('h2');
  var i;
  var OL = document.createElement('ol');
  for (i=0; i < sections.length; ++i) {
    var LI = document.createElement('li');
    var A = document.createElement('a');
    A.innerHTML = sections[i].innerHTML;
    if (A.innerHTML.toUpperCase() == 'INDEX') continue;
    A.href = '#' + i;
    LI.appendChild(A);
    OL.appendChild(LI);

    var PREF = document.createElement('a');
    PREF.name = i;
    sections[i].appendChild(PREF);
  }

  var done = false;
  function work() {
    if (done) return;
    if ( document.getElementById('toc') === null) return; // no toc element
    document.getElementById('toc').appendChild(OL);
    done = true;
  };

  window.onload = work;
  setTimeout(work,800);
}());
</script>
<footer>
    <p class="is-pulled-right">
    @cympfh / mail@cympfh.cc
    </p>
</footer>
<!--

  HTML ã¨ã—ã¦ pandoc -B ã§ include ã™ã‚‹.

  <H2> ã‚’åˆ—æŒ™ã—ã¦ãã‚Œã‚‰ã«ãƒªãƒ³ã‚¯ã‚’è²¼ã£ãŸ toc ã‚’ id='toc' ã«åŸ‹ã‚è¾¼ã‚€.
  markdown ã§æ›¸ã„ã¦ã‚‹ã ã‚ã†ã‹ã‚‰ä¾‹ã¨ã—ã¦æ¬¡ã®ã‚ˆã†ãªæ®µè½ã‚’æ›¸ã‘ã°ã‚ˆã„.

```
## INDEX
<div id=toc></div>
```

  used in
  - /memo/gnuplot
  - /memo/linux
  - /memo/imagemagick

-->
<script>
(function() {
  var sections = document.getElementsByTagName('h2');
  var i;
  var OL = document.createElement('ol');
  for (i=0; i < sections.length; ++i) {
    var LI = document.createElement('li');
    var A = document.createElement('a');
    A.innerHTML = sections[i].innerHTML;
    if (A.innerHTML.toUpperCase() == 'INDEX') continue;
    A.href = '#' + i;
    LI.appendChild(A);
    OL.appendChild(LI);

    var PREF = document.createElement('a');
    PREF.name = i;
    sections[i].appendChild(PREF);
  }

  var done = false;
  function work() {
    if (done) return;
    if ( document.getElementById('toc') === null) return; // no toc element
    document.getElementById('toc').appendChild(OL);
    done = true;
  };

  window.onload = work;
  setTimeout(work,800);
}());
</script>
</body>
</html>
