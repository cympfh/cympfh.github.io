<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>[1704.02304] Adversarial Generator-Encoder Networks</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../resources/css/c.css">
  <link rel="stylesheet" href="resources/index.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 style="font-size:1em; position:absolute; left:0; top:-0.8em; font-size:2.0em !important">
    <a href='index.html'>
    <img src="../resources/img/identicon.png" style="position:relative; top:0.4em; width:1.3em;border-radius:0.8em;" /> paper/
    </a>
</h1>
<header>
<h1 class="title">[1704.02304] Adversarial Generator-Encoder Networks</h1>
</header>
<ul>
<li>
url: <a href=https://arxiv.org/abs/1704.02304>https://arxiv.org/abs/1704.02304</a>
</li>
<li>
tags: <span class="tag"><a href=index.html#GAN>GAN</a></span>
</li>
</ul>
<h2 id="概要">概要</h2>
<p>GAN の亜種のような生成モデルの提案. 潜在空間を仮定し、具体的な Discriminator の代わりに常にダイバージェンスを気にする辺り、 (言及はされていないが) <a href="VAE.html">VAE</a> とのハイブリッドという感じがした.</p>
<h2 id="links">links</h2>
<ol style="list-style-type: decimal">
<li><a href="https://arxiv.org/abs/1704.02304">arxiv</a></li>
<li><a href="http://sites.skoltech.ru/app/data/uploads/sites/25/2017/04/AGE.pdf">original paper (pdf)</a></li>
<li><a href="https://github.com/DmitryUlyanov/AGE">implementation (github)</a></li>
<li><a href="https://www.reddit.com/r/MachineLearning/comments/64j4kk/r_adversarial_generatorencoder_networks/">reddit</a></li>
</ol>
<h2 id="adversarial-generator-encoder-age">Adversarial Generator-Encoder (AGE)</h2>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
Released paper: &quot;Adversarial Generator-Encoder Networks&quot; with V. Lempitsky, A. Vedaldi. <a href="https://t.co/APSpRMo0EY">https://t.co/APSpRMo0EY</a> code <a href="https://t.co/ehdPrinzW8">https://t.co/ehdPrinzW8</a> <a href="https://t.co/vcGpsEKzzW">pic.twitter.com/vcGpsEKzzW</a>
</p>
— Dmitry Ulyanov (<span class="citation">@DmitryUlyanovML</span>) <a href="https://twitter.com/DmitryUlyanovML/status/851335919772762112">April 10, 2017</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<h3 id="生成過程">生成過程</h3>
<p><a href="VAE.html">VAE</a> のような生成過程を仮定する. 即ち、ある潜在変数の空間 (単純な確率分布が仮定される) があって、 ある過程に依って実データに写される.</p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="201pt" height="48pt" viewBox="0.00 0.00 201.00 48.31" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 44.306)">
<title>
%3
</title>
<!-- Z -->
<g id="node1" class="node">
<title>
Z
</title>
<ellipse fill="none" stroke="black" cx="27" cy="-22.306" rx="27" ry="18"/> <text text-anchor="middle" x="27" y="-18.606" font-family="Times,serif" font-size="14.00">Z</text> </g> <!-- X --> <g id="node2" class="node">
<title>
X
</title>
<ellipse fill="none" stroke="black" cx="166" cy="-22.306" rx="27" ry="18"/> <text text-anchor="middle" x="166" y="-18.606" font-family="Times,serif" font-size="14.00">X</text> </g> <!-- Z&#45;&gt;X --> <g id="edge1" class="edge">
<title>
Z-&gt;X
</title>
<path fill="none" stroke="black" d="M54.0911,-22.306C75.0963,-22.306 104.873,-22.306 128.285,-22.306"/> <polygon fill="black" stroke="black" points="128.539,-25.8061 138.539,-22.306 128.539,-18.8061 128.539,-25.8061"/> <text text-anchor="middle" x="96.5" y="-26.106" font-family="Times,serif" font-size="14.00">Generate</text> </g> <!-- X&#45;&gt;Z --> <g id="edge2" class="edge">
<title>
X-&gt;Z
</title>
<path fill="none" stroke="black" d="M144.089,-11.2124C136.966,-7.99886 128.823,-4.92279 121,-3.30599 99.673,1.102 93.327,1.102 72,-3.30599 67.4776,-4.2407 62.8481,-5.66315 58.3704,-7.31791"/> <polygon fill="black" stroke="black" points="56.8256,-4.16882 48.9111,-11.2124 59.4906,-10.6417 56.8256,-4.16882"/> <text text-anchor="middle" x="96.5" y="-7.10599" font-family="Times,serif" font-size="14.00">Encode</text> </g> </g>
</svg>
<ul>
<li>実データ空間 <span class="math inline">\(\mathcal{X} (\subseteq \mathbb{R}^m)\)</span></li>
<li>潜在空間 <span class="math inline">\(\mathcal{Z} (\subseteq \mathbb{R}^n)\)</span>
<ul>
<li>球面 <span class="math inline">\(S^{n-1}\)</span> 上の一様分布を仮定</li>
</ul></li>
</ul>
<p>これらの間を行き来するための 2 つの関数</p>
<ul>
<li>Encoder <span class="math inline">\(e: \mathcal{X} \to \mathcal{Z}\)</span></li>
<li>Generator <span class="math inline">\(g: \mathcal{Z} \to \mathcal{X}\)</span></li>
</ul>
<p>を NNs で構成、学習する.</p>
<h3 id="註意">註意</h3>
<p>本文書において、 <span class="math inline">\(\mathcal{X}, \mathcal{Z}\)</span> は確率分布である. ただし単に集合と区別なく記述する. 例えば関数の値域/定義域にこれを使ったし、 写像 <span class="math inline">\(f\)</span> で写した先の確率分布 <span class="math inline">\(\{ f(x) ; x \sim \mathcal{X} \}\)</span> のことを <span class="math inline">\(f(\mathcal{X})\)</span> などと略記する.</p>
<h3 id="誤植">誤植?</h3>
<p>論文を見ると潜在空間を 「<span class="math inline">\(M\)</span> 次元 sphere <span class="math inline">\(\mathbb{S}^M\)</span> 」という風に書いてあるが、 おそらくそれは 「球面 <span class="math inline">\(S^{M-1}\)</span>」の誤植だと思うのでそのつもりで書きます. 球面じゃなくて球体かとも疑いましたが、実装を見ると最後にベクトルの正規化を行っているので違うことが分かります.</p>
<h3 id="註意-1">註意</h3>
<p>Encoder の実装を見ますと、NN で <span class="math inline">\(n\)</span> 次元ベクトルを出力した後に正規化をしたものを出力としています. 従って <span class="math inline">\(e\)</span> の値域は厳密に <span class="math inline">\(S^{n-1}\)</span> です.</p>
<p>Generator <span class="math inline">\(g\)</span> の値域は当然ですが <span class="math inline">\(\mathcal{X}\)</span> ではなくその superset の <span class="math inline">\(\mathbb{R}^m\)</span> ですので、 それが出来るだけ <span class="math inline">\(\mathcal{X}\)</span> になるのを目指して学習を行うのだと思います.</p>
<h3 id="generator-g-の学習">Generator <span class="math inline">\(g\)</span> の学習</h3>
<p><span class="math inline">\(e(g(\mathcal{Z}))\)</span> と <span class="math inline">\(\mathcal{Z}\)</span> との間のダイバージェンス (<span class="math inline">\(\Delta\)</span> と書く) の最小化を目指す.</p>
<h3 id="encoder-e-の学習">Encoder <span class="math inline">\(e\)</span> の学習</h3>
<p><span class="math inline">\(e(\mathcal{X})\)</span> と <span class="math inline">\(\mathcal{Z}\)</span> との間の <span class="math inline">\(\Delta\)</span> の最小化を目指す. 同時に <span class="math inline">\(e(g(\mathcal{Z}))\)</span> と <span class="math inline">\(\mathcal{Z}\)</span> との間の <span class="math inline">\(\Delta\)</span> の最大化を目指す.</p>
<p>結局要するにGANだ. Discriminator の代わりに、Encoder <span class="math inline">\(e\)</span> があって、これが</p>
<h3 id="reconstruction-loss">Reconstruction loss</h3>
<p>おおよそ <span class="math inline">\(g \circ e = id_\mathcal{X}\)</span>, <span class="math inline">\(e \circ g = id_\mathcal{Z}\)</span> となるように (つまりオートエンコーダーになるような) 損失を加える.</p>
<p><span class="math display">\[L_\mathcal{X}(g, e) = \mathbb{E}_{x \sim \mathcal{X}} \| x - g(e(x)) \|^2\]</span> <span class="math display">\[L_\mathcal{Z}(g, e) = \mathbb{E}_{z \sim \mathcal{Z}} \| z - e(g(z)) \|^2\]</span></p>
<h3 id="ダイバージェンスの計算">ダイバージェンスの計算</h3>
<p>ダイバージェンス <span class="math inline">\(\Delta\)</span> を定義していなかった. 結局実際に使うのは KL ダイバージェンスである.</p>
<p><span class="math display">\[\Delta(\mathcal{P} \| \mathcal{Z})
:= \rm{KL}(\mathcal{P} \| \mathcal{Z})
\approx \rm{KL}(\mathcal{P} \| \mathcal{N})
- \rm{KL}(\mathcal{Z} \| \mathcal{N})
= \rm{KL}(\mathcal{P} \| \mathcal{N}) - \rm{Const}\]</span></p>
<p>としてこれを使う. ここで <span class="math inline">\(\mathcal{Z}\)</span> が <span class="math inline">\(S^{n-1}\)</span> 上の一様分布であるのに対して <span class="math inline">\(\mathcal{N}\)</span> を <span class="math inline">\(n\)</span> 次元正規分布とする. 平均をゼロ、分散を <span class="math inline">\(I\)</span> とする.</p>
<blockquote>
<p>一様分布と正規分布とを比較していて私は初め見た時に (誤植? もあったため余計に) 驚いたが、 先に延べたように誤植を訂正してやると、正規分布の原点から等距離なところのみでダイバージェンスを計算してるだけなので、 特に問題無さそうに思える.</p>
</blockquote>
<p>VAE では具体的にNNの出力を確率分布そのものにしているが、AGE-net ではあくまでもデータをデータに写すだけである. バッチの中でデータの分布を見て、ダイバージェンスを計算する.</p>
<p>ミニバッチ <span class="math inline">\(Q = \{q_1, q_2, \ldots, q_N : q_i \in \mathbb{R}^m \}\)</span> に就いて、 平均 <span class="math inline">\(m = \frac{1}{N} \sum_i q_i \in \mathbb{R}^m\)</span>、 分散 <span class="math inline">\(s = \frac{1}{N} \sum_i (m - q_i)^2 \in \mathbb{R}^m\)</span> (自乗の計算は要素ごと) としたときに、 (これをそういう正規分布に見立てて)</p>
<p><span class="math display">\[\textrm{KL}(Q \| \mathcal{N}) \approx -\frac{M}{2} + \sum_{j=1}^m \left[ \frac{s_j^2 + m_j^2}{2} - \log s_j \right]\]</span></p>
<p>として計算する. 定数部分を無視すれば</p>
<p><span class="math display">\[\Delta(Q \| \mathcal{N}) \approx \sum_{j=1}^m \left[ \frac{s_j^2 + m_j^2}{2} - \log s_j \right]\]</span></p>
<p>ということに出来る.</p>
<h3 id="age-net-の学習法">AGE-net の学習法</h3>
<p>以上をまとめる.</p>
<p>ダイバージェンス云々に関する目的関数</p>
<p><span class="math display">\[V(g, e) = \Delta(e(g(\mathcal{Z})) \| \mathcal{Z}) - \Delta(e(\mathcal{X}) \| \mathcal{Z})\]</span></p>
<p>とする. GAN なら <span class="math inline">\(\min_g \max_e V\)</span> とか書かれるが、 実用的には一方を固定して、もう一方を SGD (彼らの実験では Adam を使用) によって <span class="math inline">\(V\)</span> を最大化/最小化することを目指すことを繰り返す. その時に更新する方の reconstruction loss を罰金項的に加える. ここで <span class="math inline">\(\lambda, \mu\)</span> は適当なパラメータである.</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(g\)</span> の更新:
<ul>
<li><span class="math inline">\(\min \left[ V(g, e) + \lambda L_\mathcal{Z}(g, e) \right]\)</span></li>
</ul></li>
<li><span class="math inline">\(e\)</span> の更新:
<ul>
<li><span class="math inline">\(\max \left[ V(g, e) - \mu L_\mathcal{X}(g, e) \right]\)</span></li>
</ul></li>
</ol>
<h2 id="半教師アリ学習への適用">半教師アリ学習への適用</h2>
<p>全体的にVAEだと見做せば、適切な潜在変数への写像を手に入れたと考えられるので、 そこから分類タスクなどへの適用が考えられる. ラベル無しのデータでは単に AGE network 部分だけを学習すれば、半教師アリ学習になる.</p>
<!--

  HTML として pandoc -B で include する.

  <H2> を列挙してそれらにリンクを貼った toc を id='toc' に埋め込む.
  markdown で書いてるだろうから例として次のような段落を書けばよい.

```
## INDEX
<div id=toc></div>
```

  used in
  - /memo/gnuplot
  - /memo/linux
  - /memo/imagemagick

-->
<script>
(function() {
  var sections = document.getElementsByTagName('h2');
  var i;
  var OL = document.createElement('ol');
  for (i=0; i < sections.length; ++i) {
    var LI = document.createElement('li');
    var A = document.createElement('a');
    A.innerHTML = sections[i].innerHTML;
    if (A.innerHTML.toUpperCase() == 'INDEX') continue;
    A.href = '#' + i;
    LI.appendChild(A);
    OL.appendChild(LI);

    var PREF = document.createElement('a');
    PREF.name = i;
    sections[i].appendChild(PREF);
  }

  var done = false;
  function work() {
    if (done) return;
    if ( document.getElementById('toc') === null) return; // no toc element
    document.getElementById('toc').appendChild(OL);
    done = true;
  };

  window.onload = work;
  setTimeout(work,800);
}());
</script>
</body>
</html>
