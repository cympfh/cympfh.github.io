<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="unidoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Functional Programming with Bananas, Lenses, Envelopes and Barbed Wire</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="https://cympfh.cc/resources/css/youtube.css" />
  <link href="https://unpkg.com/prismjs@1.x.0/themes/prism.css" rel="stylesheet" />
  <script id="MathJax-script" async src="https://unpkg.com/mathjax@3/es5/tex-chtml-full.js"></script>
  <link href="resources/css/c.css" rel="stylesheet" />
  <link href="../resources/css/c.css" rel="stylesheet" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

</head>
<body>
<header class="page-header">
    <a href='index.html'><i class="fa fa-send-o"></i></a>
</header>

<h1 class="title">Functional Programming with Bananas, Lenses, Envelopes and Barbed Wire</h1>
<p><ul> <li>original paper: <a href=https://maartenfokkinga.github.io/utwente/mmf91m.pdf>https://maartenfokkinga.github.io/utwente/mmf91m.pdf</a></li> </ul> <div class='is-pulled-right'> <a class='tag is-blue' href=index.html#計算>計算</a> <a class='tag is-blue' href=index.html#圏論>圏論</a> </div></p>
<p>\(\require{amscd}\) \(\def\banana#1{(\!|#1|\!)}\) \(\def\lense#1{[\!(#1)\!]}\) \(\def\envelop#1{[\![ #1 ]\!]}\) \(\def\wire#1{[\!\!\langle #1 \rangle\!\!]}\) \(\DeclareMathOperator{\cons}{cons}\) \(\DeclareMathOperator{\foldr}{foldr}\) \(\def\Nil{\mathit{Nil}}\) \(\def\Bool{\mathit{Bool}}\) \(\def\true{\mathit{true}}\) \(\def\false{\mathit{false}}\) \(\def\const#1{#1^\bullet}\) \(\def\VOID{\mathit{VOID}}\) \(\def\join{\mathit{join}}\) \(\def\triangle{\mathop{}\!\mathbin\Delta\;}\)</p>
<p><strong>注意</strong> この記事はあまり形式的な圏論で記述されてない. 考えてる圏は Hask 圏かもしくはせいぜい Set 圏である. 射のことを関数と書いてあったり, 対象の「要素」なるものを前提なしに取り上げている.</p>
<h2>概要</h2>
<p>一般の再帰的データ構造について, ちょうど, リストに対する畳み込み (fold) といったような4種類の操作 (catamorphism, anamorphism, hylomorphism, paramorphism) を統一的に与える.</p>
<h2>表記</h2>
<p>この論文では独特な括弧が4種類導入されている. できるだけオリジナルの見た目を模倣して, ここでは次のように表記する.</p>
<table>
  <thead>
    <tr class=header>
      <th align=left>名称</th>
      <th align=center>表記</th>
      <th align=center>代替表記</th>
      <th align=left>備考</th>
    </tr>
  </thead>
  <tbody>
    <tr class=odd>
      <td align=left>バナナ括弧</td>
      <td align=center>\(\banana{\_}\)</td>
      <td align=center><code>(| |)</code></td>
      <td align=left>果物のバナナ</td>
    </tr>
    <tr class=even>
      <td align=left>レンズ括弧</td>
      <td align=center>\(\lense{\_}\)</td>
      <td align=center><code>[( )]</code></td>
      <td align=left>凹レンズ</td>
    </tr>
    <tr class=odd>
      <td align=left>封筒括弧</td>
      <td align=center>\(\envelop{\_}\)</td>
      <td align=center><code>[[ ]]</code></td>
      <td align=left></td>
    </tr>
    <tr class=even>
      <td align=left>有刺鉄線</td>
      <td align=center>\(\wire{\_}\)</td>
      <td align=center><code>[&lt; &gt;]</code></td>
      <td align=left>\([\) と \(\langle\) の重ねあわせ</td>
    </tr>
  </tbody>
</table>
<p>他にこの論文で使われてる表記で次のものをこの文書でも用いる.</p>
<ul>
  <li>
    \(\const{c}\)
    <ul>
      <li>型 \(C\) の値 \(c\) (或いは \(c \in C\) ) と任意の型 (集合) \(A\) について, \(A \to C\) なる定数関数のこと</li>
      <li>\(\forall a \in A, \const{c}(a)=c\)</li>
    </ul>
  </li>
</ul>
<p>またこの論文で使われている表記で, あまり一般的に思えないものについては次の一般的な表記を用いる.</p>
<ul>
  <li>
    \(A \times B\)
    <ul>
      <li>対象 \(A, B\) の積</li>
      <li>タプル型, 集合の直積</li>
    </ul>
  </li>
  <li>
    \(A + B\)
    <ul>
      <li>対象 \(A, B\) の直和</li>
      <li>直和型, 集合の直和</li>
    </ul>
  </li>
  <li>
    \(f \colon A \to B\)
    <ul>
      <li>\(f\) は \(A\) から \(B\) への射</li>
      <li>あるいは関数, 演算</li>
    </ul>
  </li>
  <li>
    \([A]\)
    <ul>
      <li>型 \(A\) の要素に持つリストの型</li>
    </ul>
  </li>
</ul>
<h2>リストの場合</h2>
<p>\([A]\) 型の場合を考える.</p>
<h3>catamorphism</h3>
<p>"cata-" は catastrophic のそれであって, 下方へ, といった意味らしい. リストについての catamorphism は如何のような関数 \(h\) である.</p>
<ul>
  <li>\(h \colon [A] \to B\)</li>
  <li>\(h~[] = b\)</li>
  <li>\(h~(\cons(a, as)) = a \oplus h(as)\)</li>
</ul>
<p>ここで \(b\) は \(B\) の定数. \(\oplus\) は \(A \times B \to B\) なる二項演算子. このような形の \(h\) は Haskell のような言語では <code>foldr</code> として知られており</p>
\[h = \foldr(b, \oplus)\]
<p>のように書ける. すなわち \(h\) という関数は \(b, \oplus\) によって決定するから, ここでは <strong>バナナ括弧</strong> で括ることで</p>
\[h = \banana{b, \oplus}\]
<p>と書くことにする.</p>
<p>例えばリストの長さを取る関数は \(\banana{0, (\_,n)\mapsto n+1}\) と書けることが分かる. 他に <code>filter</code> もこの形で定義できる.</p>
<h3>anamorphism</h3>
<p>ちょうど catamorphism の逆のもので, <code>unfold</code> のような名前で知られている関数 \(h\) を次のように定義する.</p>
<ul>
  <li>\(h \colon B \to [A]\)</li>
  <li>\(h~b = \begin{cases} [] &amp; \text{ when } p~b \\ \cons(a, h~b&#x27;) &amp; \text { otherwise, where } (a,b&#x27;)=g~b\end{cases}\)</li>
</ul>
<p>ただしここで \(p\) は \(B \to \Bool\) なる述語関数 ( \(\Bool\) は普通の意味で). \(g\) は \(B \to A \times B\) なる関数.</p>
<p>やはりこの \(h\) は \(p, g\) で決まる関数なので, 今度はレンズ括弧で括って</p>
\[h = \lense{g, p}\]
<p>と書いて表す.</p>
<p>例えば, 関数 \(f \colon A \to A\) を繰り返し適用する <code>iterate f</code> という関数 \(A \to [A]\) は \(\lense{a \mapsto (a, f~a), \const{\mathrm{false}}}\) と書ける.</p>
<h4>map 関数</h4>
<p>リスト \([A]\) と関数 \(f \colon A \to B\) があるときに, リストの各要素に \(f\) を適用することで \([A] \to [B]\) という関数を構成することができる. Haskell では <code>map f</code> とこれを書くが, 論文に倣って \(f*\) と書くことにする. これは \([A]\) からの catamorphism として書くこともできるし, \([B]\) への anamorphism と書くこともできる.</p>
<ul>
  <li>\(f* = \banana{[], (a, b) \mapsto \cons(f~a, f*b)}\)</li>
  <li>
    \(f* = \lense{\cons(a, as) \mapsto (f~a, as), \mathrm{nil}}\)
    <ul>
      <li>
        where
        <ul>
          <li>\(\mathrm{nil}~[]=\mathrm{true}\)</li>
          <li>\(\mathrm{nil}~\cons(x, xs)=\mathrm{false}\)</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<h3>hylomorphism</h3>
<p>リストに関する hylomorphism とは, 例えば木構造をリストにしてやるような「線形再帰関数」のもの. 具体的には</p>
\[h : A \to C\]
\[h~a = \begin{cases}c &amp; \text{ when } p~a\\ b \oplus h~a&#x27; &amp; \text{ otherwise, where } (b,a&#x27;) = g~a\end{cases}\]
<p>と書き表されるもの. ここで \(c \colon C\) , \(g \colon A \to B \times A\) , \(\oplus \colon B \times C \to C\) であって \(h \colon A \to C\) である.</p>
<p>今度の \(h\) は \(c,\oplus, g,p\) によって決定されるので</p>
\[h=\envelop{(c,\oplus), (g,p)}\]
<p>と書き表すことにする.</p>
<p>そしてこれは明らかに</p>
\[\envelop{(c,\oplus), (g,p)} = \banana{c,\oplus} \circ \lense{g,p}\]
<p>という合成の形に分解できる. この証明は論文にはあるが省略. リストが一見登場しないが, この合成の形を見れば, 中間でリストを経由してることが分かる.</p>
<p>例えば自然数の階乗を計算する関数 \(\mathbb N \to \mathbb N\) は \(\envelop{(1,\times), ((1+n) \mapsto (1+n, n), \mathrm{zero})}\) と書ける. ここで \(\mathrm{zero}\) は引数がゼロかを判定する述語とする. つまり \(\lense{g,\mathrm{zero}}(m)=[m,m-1,\ldots,1]\) であって \(\banana{1,\times}\) はそれを乗算しながら畳み込む関数である.</p>
<h3>paramorphism</h3>
<p>原始再帰のパターンを提供するのが paramorphism であって, リストに関する paramorphism は 次のように定義される.</p>
<ul>
  <li>\(h \colon [A] \to B\)</li>
  <li>\(h~[]=b\)</li>
  <li>\(h~\cons(a,as)= a \oplus (as, h~as)\)</li>
</ul>
<p>ここで \(b\colon B\) , \(\oplus\colon A \times([A]\times B) \to B\) である. このような \(h\) はやはり \(b,\oplus\) で決定されるので,</p>
\[h=\wire{b, \oplus}\]
<p>と書くことにする.</p>
<p>\(\oplus\) の型が豪華になったので, 値を蓄積しながらのような関数が書けるようになった. 例えば <code>tails</code> は \(\wire{\cons(\Nil,\Nil), (a\oplus(as,ac)=\cons(\cons(a,as),ac))}\) と書ける.</p>
<h2>代数的データ型 (Algebraic data types)</h2>
<h3>双関手 (bifunctor)</h3>
<p>双関手とは2つの対象の組を対象に写して2つの射の組を射に写すようなもので, \(f\colon A\to B\) と \(g\colon C\to D\) を \(f \dagger g \colon A \dagger C \to B \dagger D\) とするような \(\dagger\) といったもの. ただし \(1\dagger 1=1\) , \((f\dagger g) \circ (h \dagger j) = fh \dagger gj\) となるもの. 双関手の変数として \(\dagger, \ddagger\) を用いる.</p>
<h3>積</h3>
<p>2つの対象 \(A,B\) の積とは \(A \times B\) なる対象. \(\times\) は双関手であり, \(f \colon A \to B\) と \(g \colon C \to D\) とに対して \(f \times g \colon A \times C \to B \times D\) を定める.</p>
<p>また任意の \(A,B\) に対して 射影関数 \(\pi_1 : A \times B \to A\) と \(\pi_2 : A \times B \to B\) を伴う.</p>
<p>関数的に書くと</p>
<ul>
  <li>\((f \times g)(x, x&#x27;)=(fx, gx&#x27;)\)</li>
  <li>\(\pi_1(x,x&#x27;)=x\)</li>
  <li>\(\pi_2(x,x&#x27;)=x&#x27;\)</li>
</ul>
<p>また二項演算子 \(\triangle\) を</p>
<ul>
  <li>\((f \triangle g) x = (fx, gx)\)</li>
</ul>
<p>と定める. 例えば \(f \times g = (f\pi_1) \triangle (g\pi_2)\) である. また簡単に \(\triangle\) を単項コンビネータとして用いて \(\triangle x = (x,x)\) とする. これを用いると \(f \triangle g = (f \times g) \triangle\) と書ける.</p>
<h3>和</h3>
<p>対象 \(A\) と \(B\) の和を, \(A\) と \(B\) と加えて \(\{\bot\}\) との直和として定める.</p>
\[A+B = A \amalg B \amalg \{\bot\}\]
<p>\(f\colon A \to B, g \colon C \to D\) に対して \(f+g \colon A+C \to B+D\) を定める. これは関数的に書くと, \(A\) のものは \(f\) によって \(B\) に, \(C\) のものは \(g\) によって \(D\) に, そして \(\bot\) は \(\bot\) に写すもの.</p>
<ul>
  <li>\((f+g) \colon A+C \to B+D\)</li>
  <li>\((f+g) a = f a\)</li>
  <li>\((f+g) c = g c\)</li>
  <li>\((f+g) \bot = \bot\)</li>
</ul>
<p>自明な埋め込み射 \(A \to A+B\) と \(B \to A+B\) が存在する.</p>
<ul>
  <li>\(i_1 : A \to A+B\)</li>
  <li>\(i_1 a = a\)</li>
  <li>\(i_2 : B \to A+B\)</li>
  <li>\(i_2 b = b\)</li>
</ul>
<p>積の時と同様に \(\triangledown\) という射に関する二項演算子を導入する. これは選択的に射を適用するようなもので \(f\colon A \to B, g \colon C \to B\) について</p>
<ul>
  <li>\((f \triangledown g) \colon A+C \to B\)</li>
  <li>\((f \triangledown g) a = fa\)</li>
  <li>\((f \triangledown g) c = gc\)</li>
</ul>
<p>のようなもの.</p>
<p>例えば \(f\colon A \to B, g \colon C \to D\) について 後ろに \(i\) を合成すれば \(f+g = i_1 f \triangledown i_2 g\) と書ける. そしてやはり単項コンビネータとしても流用して,</p>
<ul>
  <li>\(\triangledown \bot=\bot\)</li>
  <li>\(\triangledown (a \in A+C) = (a \in A)\)</li>
  <li>\(\triangledown (c \in A+C) = (c \in C)\)</li>
</ul>
<p>のように使う.</p>
<h3>矢印</h3>
<p>二項演算子 \(\to\) を定める. 対象 \(A,B\) について \(A\to B\) とは対象であって, \(A\) から \(B\) への射全体の集まりを表す. そしてこのような対象には次の射が考えられる.</p>
<p>2つの射 \(f \colon A \to C\) と \(g \colon C&#x27; \to B\) について</p>
\[(f \to g) \colon (C \to C&#x27;) \to (A \to B)\]
\[h \mapsto g \circ h \circ f\]
<p>を定める.</p>
\[\begin{CD}
A @&gt;f&gt;&gt; C @&gt;h&gt;&gt; C&#x27; @&gt;g&gt;&gt; B
\end{CD}\]
<blockquote>\((f \to g)\) とはその間を埋める射を受け取って全体を合成して出来る射を返すもの</blockquote>
<p>\((g \leftarrow f)\) を \((f \to g)\) と同じ意味で用いる.</p>
<p>関手 \(F\) があるときに次のような矢印記法を用いる.</p>
\[(f \xrightarrow{F} g) = g \circ Fh \circ f\]
<p>また次の合成則がある.</p>
\[(f \to g) \circ (h \to j) = (h \circ f) \to (g \circ j)\]
\[\begin{CD}
A @&gt;f&gt;&gt; B @&gt;h&gt;&gt; C @&gt;&gt;&gt; D @&gt;j&gt;&gt; E @&gt;g&gt;&gt; F
\end{CD}\]
<h3>恒等関手, 定数関手</h3>
<p>恒等関手 \(1\) とは対象と射について恒等的に返すもので \(1D=D, 1f=f\) .</p>
<p>自由に選んだ対象 \(D\) に対して, 全ての対象を \(D\) に写すような関手 \(\underline{D}\) を定数関手という. ただし射は全て \(1_D\) に写すとする.</p>
<h3>Lifting</h3>
<p>関手 \(F, G\) に対して関手 \(FG\) を次のように定める:</p>
<ul>
  <li>\(FG(D) = G(FD)\)</li>
  <li>\(FGf = G(Ff)\)</li>
</ul>
<p>また更に双関手 \(\dagger\) があるときに関手 \(F \dagger G\) を次で定める:</p>
<ul>
  <li>\((F \dagger G)D = FD \dagger GD\)</li>
  <li>\((F \dagger G)f = Ff \dagger Gf\)</li>
</ul>
<h3>Sectioning</h3>
<p>二項演算子 \(\oplus\) があるとき, 関数 \((a \oplus)\) を \((a \oplus) b=a\oplus b\) で定める. 同様に関数 \((\oplus b) a = a \oplus b\) を定める. この書き方を sectioning という. 必ず括弧で括る.</p>
<p>以上の記号を用いると, 例えば対象 \(A,B\) について \((\underline{A} \dagger 1)(B)=A \dagger B=(A \dagger)B\) なので \(\underline{A} \dagger 1 = (A \dagger)\) だと言える.</p>
<h3>その他</h3>
<p>終対象 (単集合) を \(\mathbb 1\) と書く. またこれの要素を \(() \in \mathbb 1\) と書いて void と呼ぶ.</p>
<p>さて述語関数 \(p : A \to \Bool\) に対して関数 \(p?\) を次のように定める:</p>
<ul>
  <li>\(p? \colon A \to A+A\)</li>
  <li>\(p? a = \begin{cases}
    \bot &amp; \text{ when } p~a = \bot \\
    i_1 &amp; \text{ when } p~a = \true \\
    i_2 &amp; \text{ when } p~a = \false \\
\end{cases}\)</li>
</ul>
<p>例えば \((f \triangledown g) \circ p?\) は我々がよく知る if 文 <code>if p then f else g</code> を表現している.</p>
<p>任意の値を \(()\) に写す定数関数を \(\VOID\) と呼ぶことにする. \(\VOID \circ f=\VOID\) である.</p>
<p>再帰を作るために \(\mu : (A \to A) \to A\) を定義する.</p>
<ul>
  <li>
    \(\mu~f = x\)
    <ul>
      <li>where \(x = f~x\)</li>
    </ul>
  </li>
</ul>
<p>2つの関手 \(F,G\) とがあるとき, 対象 \(A\) に \(\varphi_A \colon FA \to GA\) を与えるような \(\varphi\) をポリモーフィズム (polymorphism, 多相関数) といい \(\varphi \colon F \to G\) と書く. 自然関手とは可換性を保つポリモーフィズムだと言える. \(\varphi\) が自然変換であるとはポリモーフィズムであって, 射 \(f : A \to B\) があるならば, \(\varphi_B \circ Ff = Gf \circ \varphi_A\) という可換性を満たすもののこと.</p>
<h3>再帰型</h3>
<p>以上の操作を再帰的に行って得られる型を再帰型という (ってことだよね).</p>
<p>ここで次のような定理が知られている.</p>
<p>関手 \(F\) であって連続なものを考えると, ある対象 \(L\) があって, 次を満たす2つの射 \(in : FL \to L\) と \(out : L \to FL\) がある:</p>
<ul>
  <li>\(in \circ out = 1\)</li>
  <li>\(out \circ in = 1\)</li>
  <li>\(1 = \mu(in \xleftarrow{F} out)\)</li>
</ul>
<p>\(F\) に対して上記のような \((L,in)\) のことを \(\mu_F\) と書いて最小不動点と呼ぶ.</p>
<p>例として関手 \(LX = \mathbb 1 + A \times X\) を考えると, その最小不動点は \(\mu_L = ([A], (\const{\Nil} \triangledown \cons))\) であって正にリストとその構成を表している. 同様に \(NX= \mathbb 1 + N\) の最小不動点は \((\mathbb N, (\const{0} \triangledown (1+)))\) である.</p>
<h2>再帰スキーム</h2>
<p>一般の再帰型について cata-, ana-, hylo-, paramorphism を与えることをする.</p>
<p>関手 \(F\) に対して \((L,in)=\mu_F\) であるとする. 3つのポリモーフィズム</p>
<ul>
  <li>\(\varphi_A \colon FA \to A\)</li>
  <li>\(\psi_A \colon A \to FA\)</li>
  <li>\(\xi_A \colon F(A \times L) \to A\)</li>
</ul>
<p>があるとき次を定める.</p>
<ul>
  <li>
    catamorphism
    <ul>
      <li>\(\banana{\varphi}_F = \mu(\varphi_A \xleftarrow{F} out)\)</li>
    </ul>
  </li>
  <li>
    anamorphism
    <ul>
      <li>\(\lense{\psi}_F = \mu(in \xleftarrow{F} \psi_A)\)</li>
    </ul>
  </li>
  <li>
    hylomorphism
    <ul>
      <li>\(\envelop{\varphi, \psi}_F = \mu(\varphi_B \xleftarrow{F} \psi_A)\)</li>
    </ul>
  </li>
  <li>
    paramorphism
    <ul>
      <li>\(\wire{\xi}_F = \mu(f \mapsto \xi_A \circ F(1_L \triangle f) \circ out)\)</li>
    </ul>
  </li>
</ul>
<p>ここで \(A, B\) は任意の対象. また左辺の括弧にはどの関手によって定めるものかを表す添字 \({}_F\) があるが, これは誤解がない限り省略する.</p>
<blockquote>1つ目の \(\varphi_L \xleftarrow{F} out\) は \(f \colon L \to A\) を取って \(A \xleftarrow{\varphi_A} FA \xleftarrow{Ff} FL \xleftarrow{out} L\) の合成を返す関数. これの \(\mu\) なので \(f = \varphi_L \circ Ff \circ out\) なる \(f\) が \(\banana{\varphi}\) .</blockquote>
<blockquote>2つ目以降について型だけ書くと \(\lense{\psi} \colon A \to L\) , \(\envelop{\varphi, \psi} \colon A \to B\) , \(\wire{\xi} \colon L \to L\) .</blockquote>
<p>リストの場合を思い出すと \(\banana{e, \oplus}\) などと書いてたものは \(\banana{\const{e} \triangle \oplus\!}\) と同等のものであったことが分かる. 同様に \(\lense{g,p}\) と書いていたものは \(\lense{(\VOID + g) \circ p?}\) と書き直される. 具体的には次に計算規則として見ていく.</p>
<h2>計算規則</h2>
<p>cata, ana, para については共通に Evaluation Rule (対訳不明), Uniqueness Property (唯一性?), Fusion Law (融合則) が成り立つことを見ていく. その中で次の幾つかの定理を用いる.</p>
<p><div class=thm> Fixed point fusion (Free theorem)</p>
<p>関数 \(f\) が正格で, \(f \circ g = h \circ f\) ならば</p>
\[f (\mu g) = \mu h\]
<p></div></p>
<p>hylo については ana と cata とに分解できることと次の定理を利用する.</p>
<p><div class=thm> \(g \circ h = 1\) ならば</p>
\[\mu(f \xleftarrow{F} g) \circ \mu(h \xleftarrow{F} j) = \mu(f \xleftarrow{F} j)\]
<p></div></p>
<h3>Evaluation Rule for Catamorphism (CataEval)</h3>
<p><div class=thm> catamorphism の evaluation rule は次のようなものである:</p>
<p>関手 \(F\) とポリモーフィズム \(\varphi \colon F \to 1\) とその射 \(\varphi_A : FA \to A\) について, \(\mu_F=(L,in)\) とすると</p>
\[\banana{\varphi} \circ in = \varphi_A \circ F \banana{\varphi}\]
\[\begin{CD}
L @&lt;in&lt;&lt; FL \\
@V\banana{\varphi}VV @VF\banana{\varphi}VV \\
A @&lt;\varphi_A&lt;&lt; FA
\end{CD}\]
<p></div></p>
<p>これは \(\banana{\varphi}\) の定義から従う. \(\banana{\varphi} = \mu( \varphi_A \xleftarrow{F} out )\) であったが \(\mu\) の定義より \(\banana{\varphi} = \varphi_A \circ F \banana{\varphi_A} \circ out\) . 両辺の右に \(in\) を掛けると, \(in\) は \(out\) の逆射だったので \(\banana{\varphi} \circ in = \varphi_A \circ F \banana{\varphi_A}\) を得る.</p>
<p>さてこの法則は evaluation rule という名前の通り, \(\banana{\varphi}\) を具体的に計算するための方法を示している.</p>
<h4>例</h4>
<p>リストの <code>foldr</code> は次のようなものだった</p>
<ul>
  <li>関手 \(LX = 1+AX\)</li>
  <li>
    \(\mu_L = ([A], in)\)
    <ul>
      <li>\(in = \const{\Nil} \triangledown \cons\)</li>
    </ul>
  </li>
  <li>
    ポリモーフィズム \(\varphi_X = \const{c} \triangledown \oplus\)
    <ul>
      <li>\(\const{c} \colon 1 \to X\)</li>
      <li>\(\oplus \colon A \times X \to X\)</li>
    </ul>
  </li>
</ul>
<p>これらに対して \(\banana{\varphi}\) が foldr. では具体的な値について foldr の計算をしてみる.</p>
<p>ただし \(L[A]=1+A[A]\) について \(() \in 1\) の場合と \((a,as) \in A[A]\) の場合に分ける. これは \(in~() = \Nil\) と \(in(a,as) = \cons(a,as)\) の場合に分けてるのと同等 ( \(in\) は同型射なので).</p>
\[\begin{align*}
\banana{\varphi} \Nil
&amp; = \banana{\varphi} \circ in () \\
&amp; = \varphi \circ L\banana{\varphi} () \\
&amp; = \varphi \circ (1 + 1_A \banana{\varphi}) () \\
&amp; = \varphi () \\
&amp; = (\const{c} \triangledown \oplus) () \\
&amp; = c
\end{align*}\]
\[\begin{align*}
\banana{\varphi} \cons(a, as)
&amp; = \banana{\varphi} \circ in (a,as) \\
&amp; = \varphi \circ L\banana{\varphi} (a,as) \\
&amp; = \varphi \circ (1 + 1_A \banana{\varphi}) (a,as) \\
&amp; = \varphi (a, \banana{\varphi} as) \\
&amp; = (\const{c} \triangledown \oplus) (a, \banana{\varphi} as) \\
&amp; = a \oplus (\banana{\varphi} as)
\end{align*}\]
<p>これで全ての場合を網羅できている.</p>
<h3>Uniqueness Property for catamorphism (CataUP)</h3>
<p><div class=thm></p>
\[f=\banana{\varphi}_F
\iff
f \bot = \banana{\varphi}_F \bot
\land
f \circ in = \varphi \circ Ff\]
<p></div></p>
<p>すなわち, 先の Evaluation Rule を満たすような \(\banana{\varphi}\) は唯一しか存在しないことを主張する.</p>
<p>これもほぼ自明. \((\Rightarrow)\) は Evaluation Rule のまんまなので自明. \((\Leftarrow)\) . \(f~in=\varphi Ff \implies f=\varphi Ff~out \implies f = \mu(\varphi \xleftarrow{F} out) = \banana{\varphi}\) .</p>
<h3>Fusion Law for catamorphism (CataFusion)</h3>
<p><div class=thm> \(f \circ \varphi = \psi \circ Ff\) のとき</p>
\[f \circ \banana{\varphi} = \banana{\psi}\]
<p><center></p>
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASMAAAD7CAYAAAAhOvLbAAAABmJLR0QA/wD/AP+gvaeTAAAVJklEQVR4nO3deZRcZZmA8ac7IQmgyComJCRglE1AjhJAgQAyyqBAVMKAAi4ojBBEh1EYHObkyKiAERQdRlARFTW4TFQUFWUwCgguMOKwTiKriUCIGhYhhO754711ulJd1VXVXV3fvbee3zl1KlV1q+6b7q/f+u63giRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJkiRJKrG+1AFoTOYAL615bh2wOEEsknrcfsBaYBA4HNgobTiSetm9wKrUQUhj0Z86AHXE2uwmFZbJSFIumIwk5YLJSFIumIwk5YLJSFIumIx6w0tSByA1YzIqj0aj6fuBd3czEGk0TEblMBXYEphc8/xk4CLgvm4HJLVrYuoANCZ7AacCz88eLwNWElNDpgDbAc8DZiSJTpIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSZIkSVKhbQzMSh2EpN62FXAT8MuEMRwKLE94fmlUXHa2c7YDfghMAv4+YRzPA7ZPeH5pVFyQvzN2BX4BrAX2A+5OG46kXnQQ8FfgWmCTxLEAHEUsyC+phxwLPAN8hbg8ywOTkdRjTgcGgPNpvIFiCiYjqYcsJBLRaYnjqMdkJPWIDwPPASekDqQBk5FUcn3AhcA64G2JYxmJyUgqsT7gM0TX/ZGJY2nGZCSV1ATgcqLXbF7aUFpiMpJKaAPgm8CTwGsTx9Iqk5FUMhOBJcAaYG7iWNphMpJKZALwNeAJ4NWJY2mXyUgqiT7gs0Qb0SGJYxkNk5FUEh8nes0OSx3IKJmMpBL4CDGO6OjUgYyByUgquH8ipni8K3UgY2QykgpsAZGITh7Hc7wEeHv273OAvUb5OdXvPbDO55iMVEgurgbHAxcBZwAXj9M53gS8l1hqBGL80mh/9tXvvQ7YGThzTNFJOdDryehA4HPAeUTD9XjYDXg/cCoxwbbTvgjsQHEGZUp19XIy2gn4NvBd4EPjdI4J2Tm+Ok6fX3E2MRxh43E+jzRuejUZbQl8D/g/oh1nYJzOcwSwDTGAspmtgJOIxfRnEAlyAa0tZfsQ8DixvIlUSL2YjDYkElE/MZboqXE81wJicf41TY7bE/gNcRl3P/AjYGvgPcCvgBe1cK4bgTePOlIpsV5LRv3AFcBLie2EHhnHc/UB+wArmhw3kVgV4Dbg80Ti6ScavOdmj89v4XwPAzOJrYqkwum1ZLQIeAMwH7hnnM81FZhC82S0O9Ejdmv2eHNilQCAVcQWSG+m+TrblcQ6q91ApTzopWR0CvA+YpXG67pwvq2z+2aXaNtl95W91vpZf5zQz4GNqj6vkVXZ/bRWA5TypFeS0UHAJ4F/BRZ36ZzLiKSyRZPj/pjd79Tg9T5i0u6jTT6n0pP2l5aik3KmF5LRtkQC+h7wsS6e93Fiz/sXNjnu90QC2afB64cAP6X5GKVKjWg828GkcVP2ZDSFGOezkhhp3e1pErfSPBk9AZwF7M3wtZN2A15OjA5vZhqR1Jq1UUm5NDF1AOPsUmLczhyGGoW7aQkxQnrjJuf/TyIpLQaWApsBXyJ6/fYHbm/hXHsAlxHLn0jKkROJS5vXJY7jaoavjXQujS/LDgPuJHrV6qn33p2Ap4nE60RZFVJZa0a7Eg3WHwF+nDiWk4hxRD+gtZHeDxC1pNUtHLslMQl3PnAlcDDwyuy1E2uOXUP3Gu8lEYP+7gR+RswNy4M3Eu1CFSPVjHYHfj3CZ1W/dxJx+TdAXJ6tBZ4lFohbW3UbBL4wytilrihjA/YlxCXOWxifWfKjsQT4Oq1P12j1MmsvIuk+SywtsgFR251Q9XiD7NhW5sdJ6pDjiFpC3pfTmEDzEdWtvvcAInmNdFtFfmqJUulNJ9pZLkgdSJf1A3+icSJ6BrgwWXRSj+knpnjcTszK7zWLiKTTKCHNSRea1FvOJLq2d08dSCKvoHEieoDRXxJKasPORCJqZZRymS1neCJaSyzgL2mc9QPXEwuQ9XoD7UKGuvGrb7skjEnqGe8lurX3SB1IDsxmeCJqZRqJpDHalhhV7LrPQ35HDG2oXKJ9MG04Um/4PnAHMDl1IDlyOlFTHCSS0qyk0Ug94HDiD+7A1IHkzHSGakY3J45FKr3JxPrVTm+o73oiGY3nVt2SgH8jVlHcJnUgOXUScam2VepApDLblpilbsNsY5sB30kdhFR2lxO7wE5KHEfezUodgFRmuxJLgvxD6kAk9bYfAP9DOddgklQQ+xM9RAenDkRSb1sK/CR1EJJ62z5ErWi/1IFI6m0/Am5IHYSk3rYHxVjTWlLJfZuRt+2RpHE3k9j/y3FFkpI6F1jB0L5fktR1k4GHiUmxUqu2IiYKbw/MAD4ELAA2SRmUiu0dxEqF01IHosLYE7gfeBexHvrtwEXZ/V3Ai9KFpiK7AVicOggVxkQi6VyVPd4GuDP795bAX4AvJ4hLBfdiojv/kNSBqDAq+8ZV1kPfFfhN1etXEUvPuH9cjuVx0ulbifain6YORIWxXXZ/d3bfTySnip8DGwFbdzMotSePyegIYnzRutSBqDD+mN3v1OD1PmL770e7E45GI2/JaCox6vrq1IGoUH5PtAvt0+D1Q4ia9nNdi0htm5jovC8BXk2s3HgOse3QzcS0j6eB69r4rOr3Hwg8RW/vjHEc8HXKU7OcQlxirR7hmCeAs4BFRLl6ouq13YCXU76J1sc2ef227FarbOVjTN4EfJqh7ajPZegb7XPEciHtqH4/xLCAM8cSYIFtCDxG/IyLbALxxXQ5sVHn0S2+7zjgQeAKYBnwJeCXwMs6H2JyBxHtYvcB87LbkcBpRNvZuXXeU5by0RG7Ab+oea46mdwBfKzNz6xNRgBfpDcn155AFNBrUwcyCn3Aq4gvqlUM7Yo7SOvJqOIwomt/804GmENPEbsI15oKXFDn+SKXj46aQCym/481z1eSyYbENf2b2/zcesloOvAHYOP2wyy0m4GfEQWuUWNu3uwCLCQGLA4SDc2DVbcB2k9Gu9MbE6xXUz8ZQQyRqZXr8tHNBuwjiMFojTZf3IGIZzbw/Krn5wE7Vj2eDZxS81yth4i91T48wjFlsz9RGzgne3xKwliamUFcTtwG/C/wL8Q2VODOL2M1h/g7Wl7zfO7LRzcbsBcQ17JrGry+A9GodhqwL1HVhvhW/DYxpH8rYjDbT4BLmpzvRqKWdfqYoi6OU4lL3FuIQnc88Uf+eMqgqmwNHEW067yS2GiykniaJaC9aa8nbCaxf9z8NmPslBWkWRBwInA20SY0UPNa3stH1/QBfyN2+KhVucz6ANEYdxlRjdwse30xQ4Xq7dlrh9V5f62F2bFlbzeAqGlU90AuIF9bXO8IXEMklMEeuH23Mz+2plYTPYdLs9uj2flrV7rIe/kAuneZNpXool3R5JiVwD3Z4+3rHDM7u7+nzmu1HsnuX95KgAX3HuDiqsdfIgppXgrbXUSHwgzgfUTbxSCtdS8PAscQX2hFuR3R3o9nTJYDc7PbNsA36hyT9/IBdO8yrTIMv9ElGsQl2CNElyxEG8Jva46ZSVQ/723hnKuy+x2A/24tzEKaQow52Zn1F6J7jGgcPoBotMyDFcCnsttM4hL83URj61psLxqrtUTSqb5EK0z56FYyWkZ8w20xwjEbEV2Vd2SPG9WMlhE/9GYqPWkPtxhjUR1DtJ99pOb5PYj2gVPISWGrcT9wXnbbhbgUP4HoCTUxjV7tOL3ClI9uXaY9TlQnXzjCMRsS7Up3EtX6nWten0C0PSxp8ZyVtZBaqUUV2UnApXWevxW4ieiNnN7ViNp3O9HGN5O43LiMoVq0M+1H1uznU5jy0c2u/VsZORk9R9TUBoEPAoey/gp9hxPJ6vwWzzeNmK90V9uRFsfhwF9pPAH0O8TPtCgj0geIGfbvIdYhegPwVWL5D62vn6j9bzrCMWUrHx1zDDHvrHYgYqU37GusX+uZT4wU/S2xHs11DC0VUe/9tW4EPjG2kHPtZKKN7WHgDIam11TMJbqXKwMHP48rZ5bJlQz9bhcRK11Ws3w0cTXrd8vDUDK5hOFrGPURieidI3xmvWS0E5H46rU7Scqhbi8hchLRtVvvvI+z/shriKz9JO0PzHo38c3wh3YDlJRGt5PRg8BnqH+NuobhyWg0jibali7rwGdJ6pIUi6stIdZTqZ0Qu5Jo1a/tHaiMam3FfsCfiS1qJKktE4gEtC+RdGaM8v2S1BFbEMnodakDkdR9eVoD+zGiG7J2sKOkHpCnZAQxFcRkJPWgvCWjW2i8w4Mkdc3riHajXMyVkdS7NiRm7r89cRySuixvl2l/I+bL/F3qQCR1V96SEcTypAeTz9gk9ZCdiHajg1IHIkm/InYTlaSkTiEWDO/ExFlJGrXNifWI3pE6EEn6BsMXF1dzhzJ8N1H1LstDB7yGaMiuXU5TIzuK1pdcUfkVpjzkufv8WmL3gp5bLFzqRXlORgAfB95I7KslqcTynoyWEDP5/zl1IJLGV96T0SCxDctbqb9NkaSSyHsygtjE7w/ElkSSSqoIyehZ4ANEr8C+iWORNE6KkIwgNnL8CfApihOzpDYU6Q/7A8DuxDbZkkqmSMnod8Tk2fOAF6QNRVKnFSkZAZwBTCTGH0kqkaIlo8eA9wLvwtUgpVIpWjKCmEC7BLgUeF7iWCR1SBGTEcACot3o31MHIqkzipqMVgKnAacChySORVIHFDUZAXyFGJ39ZWBa4lgkjVGRkxHAyUSj9teACYljkTQGE1MHMEZPENNEbgbOAs5JG05HvZDYzHIvYDLwaeDHKQPSuNoPmNnkmNuyW4VlJIcWAOuI1SHLYCPgeuLycwLwHWANMKmF9xZmZT+tp4/YnmsQuA+Yl92OJNpH72b9yeKtlhHLQ5f1EZdqjwGzE8fSCW8BHqx6PAV4VYvvtfAV21PEbINaU4ELqh63WkYKUx6K3mZUMQi8E1hGTKot+nSRPYjdUSqeBm5MFIu66+kGz68E/qPqcenKSFmSEcQvYx6x19qVFLNBeyoxEfjVwMbZv50YrDnE3+pySlxGypSMIL49jgTmAh9NHMtorAOeBJ4DBrJ/P5k0IqU2ETiboS9Xy0jBHEv8ok5JHcgoLQbuGuV7C9NGoLpWE73ES7Pbo8Tvc4Oa41otI4UpD0Xv2m/kCmA6cBHwCPDNtOFIbVlO1O4hese+kjCWrilrMoLoBt2aSEx/Bn6aNhxpVNYCFxM1/VIrW5tRrdOJ8RffAnZLHIs0WkuJNqJSK3syGgCOB24BrgF2TBuO1JK+1AGkUPZkBPAMcBgxgvVnFCMhbUbxx0qpff1Ed/2mLRxrGSmwTYg5bA8C2yeOpZHNgfcTY6YGgU8y1JDZqsL0nmg9c4nxcYNEjX4RsGed49otI5aHnHoB8GvgfmBW2lDGjYVP1QpTHsrcm1bPX4m1s68lLtleQ3SjFtWWwJtqnntldn9izfNriLEpKi/LQwFtRlyyrQB2SRzLWEwihi08R3QBryV24F1X9Xgt8c34hUQxqnssDwX1AuAG4GFic8iiuoRopB9scivL8ioameWhoDYmts1eDezd4JizgF27FlH7DqB5wVtFMScOq30HYHkorA2Bq4lr6INrXptH9GzcRH7HfvQDf6JxwXsGuDBZdOo2y0PBTSSuoZ8B3po9twsxG3qAuAY/IU1oLVnEyFXzOelCUwKWh4LrAxYSyedcYunPSmPfANETt1Wi2Jp5BY0L3gPkt1an8WF5KInTGaoNVf8S1wKXpwurqeUML3hrKdcmBWqd5aEELmB4IqrcBoAD04U2ooUM1eSqb0UeuqDRW4jlodCOZeReiHXAPQxf6CoPZjM83tuTRqSULA8Ftif1v0nqJaQzE8XYzO+I2lulSv7BtOEoMctDAU0mlvCsJJtmCelpYLskkY7sdGLEbeWSclbSaJSa5aGgpgDziTFH67Jb5VulXkPgNWnCHNF0hmK+OXEsSs/yUAKbExMLf0X8MhuN2aidlJgH1xOxnZw6EOWC5aFEdiS6Qx9iaARrpdr7J2Kftjw5iaia53VMlLrL8lBCfcC+wGeJAZCV2tEnUgZVx2bEut8SWB5KbxIxb+2/iD2u8jbrf1bqAJQrs1IHoO7YlKEFrCRJkiRJkiRJkiRJkiRJkiSVmXsnqQxeT+x7dy+xvAvEdB2IPcIgVj48Bni86jlJ6qhpwB+Bq6qeW0ysTwUxY/0vwDeJbamUQ/2pA5A6YAXwY+ANxCz1Wq8ntjP/MrFonnLIZKSyuCe7377Oa7NrjlEOmYxUFsuy+23rvDaTWAzv3u6Fo3aZjFQWd2T3jWpGyxhq3FYOmYxUFncSO7zsXPP8BGLp4CVdj0htsWeh2PZl+Cp+A8BqYn3uOyh+bWAKsBHxfxrJILEv2KXAJlXPHw78DTh/XKJLZz/i8nMktxE/i1k1z5etjCgH+oBDiML1CPC27PE7gB8S+63Pb/ju/JoAvBa4HFgDHN3Ge+cD1wK/Jbr6ryOfe9yNVR9wEJGE7yPGVc0DjgROA+4GzqW8ZUQ59RhxiVLrQqKwzqvzWt70Aa8CPk0MSqzsTzdIe8mo8llXAe/sZIA59RSxc2ytqcAFVY/LUEZUACupX9C2JwpanneH2AVYCNzP+ltBVW4DtJ+MYP1Bj2W2mvrJCODFVf/OfRmxzajcts7u89YmMIPYAPMEYFcivknZa5MavUktmwP8hrgEayY3ZcRkVF6bAh8FngYuSRwLRKE/CjiO2E3lWVpPQHsDz7V5vunZ+1JYAdyQ6NwTgbOJZD/Q5Ni8lRGVwEqix+j7wDeAW4gJoY8CL0sYV8WOwDVEQqm3TXjZbt/tzI+tJauJvfuWZrdHsxg2qDku72VEJbGS6D2BaLx9MfAWovfkQeD4RHHVmkb09NxEfGs/S/M/7NG2GfWK2jajScCV1E9GRSgjKrhGjZPbEX/w64jaSZ7MBM4gRkbXa7g2GbWmXgP2XIYvD5T7MuII7HK7F/g1UTDnJI6l1v3AecRUjZcBHwMeyl5L3phacEtpvY0tN2XEZFR+W2T3qRpUW3E70b0/k/hWv4wY7AhxSaGRjfVnVIQyogKYRFSxa6vg04FFxKXOF7sdVAdsQKxDdAVwWOJY8qqfuLx9oMlxZS0jypH9gW8RhelZou3gKqLavYpoKD4xWXQaT3OJhupKu9oiYM86x1lGJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJEmSJElSHvw/queFs8I/TW8AAAAASUVORK5CYII=">
<p></center> </div></p>
<p>どう証明してもいいけど, \(\banana{}\) の定義のを開けば</p>
\[\begin{align*}
\banana{\varphi} &amp; = \mu(\varphi \xleftarrow{F} out) \\
&amp; = \varphi \circ F\banana{\varphi} \circ out \\
\end{align*}\]
<p>両辺に左から \(f\circ\) を掛けて</p>
\[\begin{align*}
f \circ \banana{\varphi}
&amp; = f \circ \varphi \circ F\banana{\varphi} \circ out \\
&amp; = \psi \circ Ff \circ F\banana{\varphi} \circ out \\
&amp; = \psi \circ F(f \circ \banana{\varphi}) \circ out \\
\end{align*}\]
<p>というわけで \(f \circ \banana{\varphi}\) は \(\mu(\psi \xleftarrow{F} out)\) である. 一方で \(\banana{\psi}\) もその \(\mu\) である. catamorphism の唯一性 (CataUP) よりそれらは等しく</p>
\[\banana{\psi} = f \circ \banana{\varphi}\]
<p>である.</p>
<p>論文では \(f \circ (\varphi \xleftarrow{F} out) = (\psi \xleftarrow{F} out) \circ f\) であることと fixed point fusion を用いて証明できる, と言っている.</p>
<h4>リスト畳込み ( <code>foldr</code> ) の融合則</h4>
<p>2つのリストの畳込み \(\banana{\varphi} = \banana{c \triangledown \oplus}\) と \(\banana{\psi} = \banana{d \triangledown \otimes}\) について, ある \(f\) があって,</p>
<ul>
  <li>\(d = fc\) ,</li>
  <li>\(f(x \oplus xs) = y \otimes f(xs)\)</li>
</ul>
<p>のとき</p>
\[f \circ \banana{\varphi} = \banana{\psi}.\]
<h3>包含射は catamorphism</h3>
<p>射 \(f \colon A \to B\) に左単位射 \(g\) ( \(gf=1\) ) があるとすると, \(Fg\) は \(Ff\) の逆射になるので \(f \circ \varphi = (f \circ \varphi \circ Fg) \circ Ff\) である. CataFusion で \(\psi = f \circ \varphi \circ Fg\) を代入すれば \(f \circ \banana{\varphi} = \banana{f \circ \varphi \circ Fg}\) を得る.</p>
\[\begin{CD}
L @&lt;in&lt;&lt; FL \\
@V\banana{\varphi}VV @VF\banana{\varphi}VV \\
A @&lt;\varphi&lt;&lt; FA \\
@VfVV @AFgAA \\
B @. FB
\end{CD}\]
<p>上の図式で \(A=L, \varphi=in\) の場合を考える. 唯一性より \(\banana{in}=1\) を得る. これらを代入することで,</p>
\[f = \banana{f \circ in \circ Fg}\]
<p>を得る. これに \(B=FL, f=out, g=in\) を代入すると,</p>
\[\begin{CD}
L @&lt;in&lt;&lt; FL \\
@V\banana{in}VV @VF\banana{in}VV \\
L @&lt;in&lt;&lt; FL \\
@VoutVV @AF~inAA \\
FL @&lt;F~in&lt;&lt; FFL
\end{CD}\]
<p>一番下の \(F(in) : F^2L \to FL\) の catamorphism を考えることで</p>
\[\banana{out \circ in \circ F(in)} = \banana{F(in)} = out\]
<p>を得る.</p>
<h3>catamorphism は正格性を保つ</h3>
<p>まず関手 \(F\) が正格性を保つ, すなわち \(f \bot=\bot \iff Ef \bot = \bot\) とする. このとき</p>
\[\varphi \bot = \bot \iff \banana{\varphi}_F \bot = \bot\]
<p>が成り立つ. 添字の \(F\) は \(F\) の下でのバナナであることを表したのに註意.</p>
<p>\((\Rightarrow)\) . \(\banana{\varphi} = \bot\) を仮定すると</p>
\[\begin{align*}
\bot &amp; = \banana{\varphi} \bot \\
     &amp; = \banana{\varphi} in \bot \\
     &amp; = \varphi F\banana{\varphi} \bot \\
     &amp; = \varphi \bot
\end{align*}\]
<p>より従う. ここで最後の式変形には \(F\) が正格性を保存することと \(\banana{\varphi}\bot=\bot\) を仮定していることから \(F\banana{\varphi}\bot=\bot\) を用いた.</p>
<h3>Evaluation Rule for Anamorphism (AnaEval)</h3>
<p>関手 \(F\) とその \(\mu_F=(L,in)\) について, \(\psi_A : A \to FA\) に対して \(\lense{\psi} = \mu(in \xleftarrow{F} \psi)\) が定義だったので,</p>
\[\lense{\psi} = in \circ F\lense{\psi} \circ \psi\]
<p>である. この両辺に左から \(out \circ\) を掛けることで次を得る. <div class=thm> AnaEval</p>
\[out \circ \lense{\psi} = F\lense{\psi} \circ \psi\]
\[\begin{CD}
X                 @&gt;\psi&gt;&gt;  FX \\
@V\lense{\psi}VV            @VF\lense{\psi}VV \\
L                 @&gt;out&gt;&gt;   FL
\end{CD}\]
<p></div> これはやはり \(\lense{\psi}\) に関する評価規則を示している.</p>
<h4>例. unfold</h4>
<p>\(A\) のリスト型 \(F \colon X \to 1+AX\) について, リストのunfoldは \(g : X \to AX\) と \(p? \colon X \to X+X\) によって \(\lense{\psi} = \lense{(VOID+g) \circ p?}\) と表されると言った. これの評価を考える.</p>
\[\begin{align*}
\lense{\psi} x &amp; = in F\lense{\psi} \psi x \\
&amp; = \begin{cases}
\bot &amp; \text{ when } p~x = \bot \\
in F\lense{\psi} () &amp; \text{ when } p~x = \true \\
in F\lense{\psi} (a,x&#x27;) &amp; \text{ when } p~x = \false, (a,x&#x27;) = g~x \\
\end{cases}
\end{align*}\]
<p>ここで \(F\lense{\psi}=1+1\times \lense{\psi}\) であるので,</p>
<ul>
  <li>\(in~F\lense{\psi}() = in() = \Nil\)</li>
  <li>\(in~F\lense{\psi}(a, x&#x27;) = in(a,x&#x27;) = \cons(a,x&#x27;)\)</li>
</ul>
<p>となっていわゆる <code>unfold</code> を得る.</p>
<h4>例. iterate</h4>
<p>\(f:A \to A\) とリスト型 \(F:X \to 1+AX\) について \(\psi_A = 1_2 \circ (1_A \triangle f) : A \to FA\) とする.</p>
\[\begin{align*}
\psi_A x
&amp; = i_2(1\triangle f) x \\
&amp; = i_2(x,fx) \\
&amp; = (x, fx) ~ \in 1+AX
\end{align*}\]
\[\begin{align*}
out \lense{\psi} x
&amp; = F\lense{\psi} \psi x \\
&amp; = (1+1\times\lense{\psi}) (x,fx) \\
&amp; = (x, \lense{\psi}(fx))
\end{align*}\]
<p>(左からinを掛けることで)</p>
\[\lense{\psi} x = \cons(x, \lense{\psi}(fx))\]
<p>を得る. これは Haskell なのでは <code>iterate f</code> として知られる.</p>
<h3>anamorphism の唯一性 (AnaUP)</h3>
\[f = \lense{\psi}_F \iff out \circ f = Ff \circ \psi\]
<h3>anamorphism の融合則 (AnaFusion)</h3>
<p>\(\varphi \circ f = Ff \circ \psi\) のとき</p>
\[\lense{\varphi} \circ f = \lense{\psi}\]
<p><center></p>
<img src="data:image/png;base64,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">
<p></center></p>
<p>唯一性より従う.</p>
<h3>全射は anamorphism</h3>
<p>以上のことは単に catamorphism の双対を取れば導けた. 全く同様に, 包含射即ち左単位射を持つ射が catamorphism であったことから, 全射即ち右単位射を持つ射は anamorphism である.</p>
<p>全射を \(f\) として, ある \(g\) によって \(fg=1\) であるとすると,</p>
\[f = \lense{Fg \circ out \circ f}\]
<p>が成立する.</p>
<p>これに \(f=in, g=out\) を代入することで,</p>
\[\lense{F(out) \circ in \circ in} = \lense{F(out)} = in\]
<p>を得る.</p>
<h3>Splitting Hylomorphism (HyloSplit)</h3>
<p>\(gh=1\) のとき, 合成則 \(\mu(f \xleftarrow{F} g) \circ \mu(h \xleftarrow{F} j) = \mu(f \xleftarrow{F} j)\) が成り立つ. これによって次の定理が成り立つ.</p>
\[\envelop{\varphi, \psi} = \banana{\varphi} \circ \lense{\psi}\]
<h3>Shifting Law for Hylomorphism (HyloShift)</h3>
<p>関手 \(F,M\) があり, \(\varphi \colon ML \to B\) , \(\psi \colon A \to FA\) , \(\xi \colon F \to M\) とする.</p>
\[\begin{CD}
A @&gt;\psi &gt;&gt; FA  @&gt;\xi_A&gt;&gt;   MA  \\
@VVV          @.            @.  \\
B @&lt;\varphi&lt;&lt; ML  @&lt;\xi_B&lt;&lt; FB   \\
\end{CD}\]
<p><center></p>
<img src="data:image/png;base64,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">
<p></center></p>
<p>上の図式において \(\envelop{\ldots} \colon A \to B\) は \(F\) に於いても \(M\) に於いてでも正しく定まり,</p>
\[\envelop{\varphi_B\xi_B, \psi_A}_F = \envelop{\varphi_B, \xi_A\psi_A}_M\]
<p>が成り立つ.</p>
<p>これは cata や ana と違って陽に \(\mu_F, \mu_M\) が登場しないからこういうことが出来る.</p>
<h3>cata と ana の関係</h3>
<p><div class=thm> \(\mu_F = (L, in_F)\) , \(\mu_M = (L, in_M)\) でこの間にポリモーフィズム \(\varphi \colon F \to M\) があるとき,</p>
\[\banana{in_M\circ\varphi}_F = \lense{\varphi\circ out_F}_M\]
\[\begin{CD}
L @&gt;\mathrm{out}&gt;&gt; FL \\
@. @V{\varphi}VV \\
L @&lt;{\mathrm{in}}&lt;&lt; ML \\
\end{CD}\]
<p></div></p>
<p><div class=thm> \(\psi \circ \varphi=1\) のとき, \(\mu\) の合成則より</p>
\[\lense{\psi} \circ \banana{\varphi} = 1\]
<p></div></p>
<p>例えば <code>foldr</code> してから <code>unfold</code> した結果が元に戻るための十分条件として, ポリモーフィズムのレベルで合成が \(1\) であることがある.</p>
<h3>Evaluation Rule for Paramorphism (ParaEval)</h3>
<p>定義がだいぶ前なので, 改めて paramorphism の定義を書くと, \(\mu_F=(L,in)\) について ポリモーフィズム \(\xi_A \colon F(AL) \to A\) があるとき \(\wire{\xi}\) とは, \(f \colon L \to L\) なる射によって</p>
\[\wire{\xi} \equiv \mu(f \mapsto \xi_L \circ F(1 \triangle f) \circ out)\]
<p>と書かれるもの.</p>
<p>従って</p>
\[\wire{\xi} = \xi_L \circ F(1_L \triangle \wire{\xi}) \circ out\]
<p>両辺に右から \(in\) を掛けることで</p>
\[\wire{\xi} \circ in = \xi_L \circ F(1_L \triangle \wire{\xi})\]
<p>を得、これが paramorphism の評価規則になっている.</p>
<h4>例. リスト</h4>
<p>\(FX=1+AX\) について \(\xi_A \colon F(AL) \to A\) の paramorphism を考える.</p>
<p>\(F(1_L \triangle \wire{\xi}) x = (1+1 \times (1_L \triangle \wire{\xi})) x\) は \(x \in 1\) なら \(() \in 1\) , さもなくば \(x=(a,b)=A \times L\) であって値は \((a, (b, \wire{\xi}~b))\) であることに註意すると,</p>
\[\begin{align*}
\wire{\xi} \Nil
&amp; = \wire{\xi} in~() \\
&amp; = \xi F(1 \triangle \wire{\xi}) () \\
&amp; = \xi ()
\end{align*}\]
\[\begin{align*}
\wire{\xi} \cons(a,as)
&amp; = \wire{\xi} in(a,as) \\
&amp; = \xi F(1 \triangle \wire{\xi}) (a, as) \\
&amp; = \xi (a, (as, \wire{\xi}~as))
\end{align*}\]
<h3>唯一性 (ParaUP)</h3>
<p><div class=thm></p>
\[f = \wire{\xi}_F \iff f \circ in = \xi \circ F(1 \triangle f)\]
<p></div></p>
<h3>融合則 (ParaFusion)</h3>
<p><div class=thm> \(f \circ \varphi = \psi \circ F(1 \times f)\) のとき</p>
\[f \circ \wire{\varphi} = \wire{\psi}\]
\[\begin{CD}
L                 @&gt;out&gt;&gt;       FL                \\
@V\lense{\psi}VV                @.                \\
L                 @&lt;\varphi&lt;&lt;   F(1 \times L)     \\
@VfVV                           @VVF(1\times f)V  \\
L                 @&lt;\psi&lt;&lt;      F(L \times L)
\end{CD}\]
<p></div></p>
<h3>定理</h3>
<p><div class=thm></p>
\[f = \wire{f \circ in \circ F\pi_1}\]
<p></div></p>
<h2>Parameterized Types (パラメータ化された型)</h2>
<p>最初のほうで map 関数というものをやった. 即ち型 \(A,B\) に対しては型 \([A], [B]\) というものを定義することが出来, 射 \(f\colon A \to B\) に対して \(f* \colon [A] \to [B]\) というものを定めることが出来た. また明らかに \(1*=1\) , \(f* \circ g* = (fg)*\) が成り立つ. この意味で \(*\) は関手である \((A* = [A])\) . これを一般化する.</p>
<h3>Sectioning について (復習???)</h3>
<p>双関手 \(\dagger\) とある対象 \(A\) について,</p>
\[(A \dagger) = \underline{A} \dagger 1\]
<p>であった. つまりこれは関手であって,</p>
<ul>
  <li>\((A\dagger)B = A \dagger B\)</li>
  <li>\((A\dagger)f = (\underline{A} \dagger 1) f = 1_A \dagger f\)</li>
</ul>
<p>と写す.</p>
<p>射 \(f \colon A \to B\) について \((f \dagger)\) はポリモーフィズムであって (!!),</p>
<ul>
  <li>\((f \dagger) \colon (A\dagger) \to (B\dagger)\)</li>
  <li>\((f \dagger)_X \colon (A\dagger X) \to (B\dagger X)\)</li>
  <li>\((f \dagger)_X = f \dagger 1_X\)</li>
</ul>
<h3>Maps</h3>
<p>関手 \(*\) を次のように定義し直す.</p>
<p>ある双関手 \(\dagger\) と対象 \(A\) について \(\mu(A\dagger) = (A*,in_A)\) であると定義する. 同様に対象 \(B\) については \(\mu(B\dagger) = (B*,in_B)\)</p>
<p>ある射 \(f \colon A \to B\) があるとき,</p>
\[\varphi = in_B \circ (f \dagger)_{B*} \colon A\dagger B* \to B*\]
<p>が定まる. この catamorphism を \(f*\) であると定義する.</p>
\[f* = \banana{in_B \circ (f \dagger)_B{*}}_{(A\dagger)}\]
\[\begin{CD}
A*   @&lt;in_A&lt;&lt; A\dagger A* \\
@Vf*=\banana{\varphi}VV \\
B*   @&lt;in_B&lt;&lt; B\dagger B* @&lt;(f\dagger)_{B*}&lt;&lt; A \dagger B*
\end{CD}\]
<p>先の "cata と ana の関係" でも見たように,</p>
\[f* = \lense{(f \dagger)_{A*} \circ out_A}_{(A\dagger)}\]
\[\begin{CD}
A* @&gt;out_A&gt;&gt; A \dagger A* @&gt;(f\dagger)&gt;&gt; B \dagger A* \\
@Vf*=\lense{\psi}VV \\
B* @&lt;in_B&lt;&lt; B \dagger B*
\end{CD}\]
<p>と書き直すことも出来る.</p>
<p>以上で関手 \(*\) が定義された. これはリストのマップとして定義した \(*\) の一般化になっている. \(A\dagger B = 1+A \times B\) とすればリストの場合が導出出来る.</p>
<h4>合成</h4>
<p>合成に関して次が成立する.</p>
\[\begin{align*}
f* \circ g*
&amp; = \banana{in \circ (f\dagger)} \circ \banana{in \circ (g\dagger)} \\
&amp; = \banana{in \circ (f\dagger) \circ (g\dagger)} \\
&amp; = \banana{in \circ ((f \circ g) \dagger)} \\
&amp; = (f \circ g)*
\end{align*}\]
<h3>Map-Reduce</h3>
<p>関手 \(F\) と対象 \(A\) について \(A \dagger X = A + FX\) としたときの \((A*,in)=\mu(A \dagger)\) を \(A\) の上の free \(F\) -type と呼ぶ.</p>
<p>\(f \colon A \to B\) について, \(f* = \banana{in_B \circ (f\dagger)_{B*}}\) であったが, 今 \(\tau_B = in \circ i_1 \colon B \to B*\) , \(\join_B = in \circ i_2 \colon B* \to B*\) とすると,</p>
\[f* = \banana{(\tau_B \circ f) \triangledown \join_B}\]
<p>と書き直せる.</p>
<p>射 \(\varphi\) に対して次で定める \(\varphi&#x2F;\) を \(\varphi\) の reduction と呼ぶ:</p>
\[\varphi&#x2F; = \banana{1 \triangledown \varphi}\]
<p>これに関して次が成り立つ.</p>
\[\begin{align*}
\banana{f \triangledown \varphi}
&amp; = \banana{(1 \triangledown \varphi) \circ (f + 1)} \\
&amp; = \banana{1 \triangledown \varphi} \circ f* \\
&amp; = \varphi&#x2F; \circ f*
\end{align*}\]
<p>さて実は \(\tau, \join\) は自然変換である.</p>
\[\begin{CD}
A @&gt;f&gt;&gt; B \\
@V\tau_AVV @V\tau_BVV \\
A* @&gt;f*&gt;&gt; B*
\end{CD}\]
\[\begin{CD}
FA* @&gt;Ff*&gt;&gt; FB* \\
@V{\join_A}VV @V{\join_B}VV \\
A* @&gt;f*&gt;&gt; B*
\end{CD}\]
<p>このことから \(f*\) の評価規則を得る:</p>
<ul>
  <li>\(f* \circ \tau = \tau \circ f\)</li>
  <li>\(f* \circ \join = \join \circ Ff*\)</li>
</ul>
<p>一方で \(\varphi&#x2F;\) の評価規則は普通に CataEval から次のようになる:</p>
<ul>
  <li>\(\varphi&#x2F;\circ \tau = 1\)</li>
  <li>\(\varphi&#x2F;\circ \join = \varphi \circ F(\varphi&#x2F;)\)</li>
</ul>
<h3>モナド</h3>
<p>free type があるとき, モナドを次のようにして与えることが出来る. つまり</p>
<ul>
  <li>関手 \(*\)</li>
  <li>自然変換 \(\tau \colon 1 \to *\)</li>
  <li>自然変換 \(\join&#x2F; \colon ** \to *\)</li>
</ul>
<p>について</p>
<ul>
  <li>\(\join&#x2F; \circ \tau = 1\)</li>
  <li>\(\join&#x2F; \circ \tau* = 1\)</li>
  <li>\(\join&#x2F; \circ \join&#x2F; = \join&#x2F; \circ \join&#x2F;*\)</li>
</ul>
<p>が成り立つ.</p>

<!--

  以下を埋め込むと H2 タグを列挙してそれぞれへのリンクにする.
  ただし "INDEX" は除外する.

    <div id=toc></div>


  H2, H3 タグまでを列挙するには以下を埋め込む.

    <div id=toc-level-2></div>

-->
<script>
(function() {

  function naming(obj, name) {
      var PREF = document.createElement('a');
      PREF.name = name;
      obj.appendChild(PREF);
  }

  function level1() {

    var sections = document.getElementsByTagName('h2');
    var OL = document.createElement('ol');
    for (var i=0; i < sections.length; ++i) {
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = sections[i].innerHTML;
      if (A.innerHTML.toUpperCase() == 'INDEX') continue;
      A.href = '#' + i;
      LI.appendChild(A);
      OL.appendChild(LI);
      naming(sections[i], i);
      // var PREF = document.createElement('a');
      // PREF.name = i;
      // sections[i].appendChild(PREF);
    }

    return OL;
  }

  function level2() {

    var sections = document.querySelectorAll('h2,h3');
    var tree = [];
    for (var i = 0; i < sections.length; ++i) {
      if (sections[i].tagName == 'H2') {
        if (sections[i].innerHTML.toUpperCase() === 'INDEX') continue;
        tree.push([sections[i]]);
      } else {
        if (tree.length > 0) {
          tree[tree.length-1].push(sections[i]);
        } else {
          tree.push([sections[i]]);
        }
      }
    }

    var OL = document.createElement('ol');
    for (var i = 0; i < tree.length; ++i) {

      // h2-level
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = tree[i][0].innerHTML;
      A.href = '#' + i;
      naming(tree[i][0], i);
      LI.appendChild(A);

      // h3-level
      if (tree[i].length > 1) {
        var OL_sub = document.createElement('ol');
        for (var j = 1; j < tree[i].length; ++j) {
          var LI_sub = document.createElement('li');
          var A = document.createElement('a');
          A.innerHTML = tree[i][j].innerHTML;
          A.href = `#${i}-${j}`;
          naming(tree[i][j], `${i}-${j}`);
          LI_sub.appendChild(A);
          OL_sub.appendChild(LI_sub);
        }
        LI.appendChild(OL_sub);
      }

      OL.appendChild(LI);
    }

    return OL;
  }

  function append_toc() {
    if (document.getElementById('toc')) {
      document.getElementById('toc').appendChild(level1());
    }
    if (document.getElementById('toc-level-2')) {
      document.getElementById('toc-level-2').appendChild(level2());
    }
  }

  window.addEventListener('DOMContentLoaded', append_toc, false);
}());
</script>

  <script src="https://cympfh.cc/resources/js/youtube.js"></script>
  <script src="https://unpkg.com/prismjs@v1.x/components/prism-core.min.js"></script>
  <script src="https://unpkg.com/prismjs@v1.x/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>