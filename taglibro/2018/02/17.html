<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="description" content="起床フェーズ, 本戦, 梅田" />
  <meta property="og:url" content="http://cympfh.cc/taglibro">
  <meta property="og:title" content="" />
  <meta property="og:description" content="起床フェーズ, 本戦, 梅田" />
  <meta property="og:image" content="http://cympfh.cc/resources/img/identicon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@cympfh" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title></title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="../../../resources/css/c.css" />
  <link rel="stylesheet" href="../../../resources/css/youtube.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>
<body>
<header class="page-header">
    <a href='../../index.html'><i class="fas fa-fast-backward"></i></a>
</header>
<h1 id="seccon2017ctf-国内-本戦---参加記録">SECCON2017CTF 国内 本戦 - 参加記録</h1>
<h2 id="起床フェーズ">起床フェーズ</h2>
<p>negainoido というチームに参加し、予選と本戦に出場してた. 予選はオンラインで人数制限がなく、我々は6人で参加したが、本戦に出場できるのは4人まででどうにかして抽選する必要がある. 我々は、貢献度の重み付き抽選を行って4人を選んだ. 私自身はそんなに大きく貢献したと言えないのだが、選ばれたので出場した.</p>
<p>SECCON 自体は 02/17から02/19 までの3日間あり、その初めの1日目の中のイベントの1つとして、国内本戦がある. (残り二日間はよりレベルの高い、国際戦がある.) 朝の10時前に北千住駅に着き、そこから徒歩5分くらいを掛けて東京電機大学に向かった. チームメンバーはなかなか来なかったので一人で受付を済ませて席で準備をしていた.</p>
<figure>
<embed src="https://pbs.twimg.com/media/DWMotGyVAAAJ_0t.jpg:small" />
</figure>
<figure>
<embed src="https://pbs.twimg.com/media/DWSyh6aU8AI2FGK.jpg:small" />
</figure>
<figure>
<embed src="https://pbs.twimg.com/media/DWSy8XeUMAEdn9-.jpg:small" />
</figure>
<p>SECCON本戦は二年ぶりの二度目だが、前回と同様に、ルーターが机に置いてあるので持参した有線LANでイントラネットに繋いで、スコアサーバ等にアクセスする仕様. あ、でも今回はインターネットにも接続できるようになっていた. チーム内のファイルの共有などを Slack で行った. 前回はインターネットが繋がってなかったので、そこがネックだった.</p>
<figure>
<embed src="https://pbs.twimg.com/media/DWSzD5hVAAMQubF.jpg:small" />
</figure>
<p>そういえばコンセントも4つ口が1つ（実は足元に＋１）しかないので、電源タップを持ってきておいて正解だった. SECCON運営はこういったアナウンスが弱いと思う. 今回は事前に Slack が立てられて参加者はそこに参加することになっていたが、無料プラン (最近の一万メッセージだけが閲覧できる) なのにプライベートチャンネルでがんがんメッセージを書き込んでるヒトがいて、書き込んだメッセージが次の日には流される状態となっていた. もっとも、食事に関する註意くらいしか、大切なことは書き込まれていなかったけれど.</p>
<h2 id="本戦">本戦</h2>
<p>1030-1100 は運営による案内があり、1100から本戦が始まった. 問題は4つあり、それぞれ、船橋、府中、幕張、梅田、という名前がついｎていた. 地名なのは間違いないが、どういう意味が込められてるのかは謎だった. それぞれの問題はそれぞれが web サービスの形をなしている. 一昨年は各チームが web サービスを運営維持するというルールだったが、今回は、運営が1つだけを運営し、各チームがそこにアタックするという仕組みだった. フラグは2種類あり、webサービスをハックすると取得できる、Attack フラグ. これは各問題について1つか2つかだけあって、ルールにその個数が書いてある. こちらがメイン. もう一つは Defence フラグというものがあり、フラグ自体はチームごとに配布されており、ただし5分したらそのフラグの期限は切れ、新しいものが配布される. このDefenceフラグは各webサービスのどこかに書き込んでおくと、5分ごとに運営がチェックし、点数が入る. こちらは、Attackでの点数に差をつけるために副次的な意味合いが強そう.</p>
<h3 id="船橋">船橋</h3>
<blockquote>
<figure>
<img src="https://i.imgur.com/i1ONLY5.png" />
</figure>
</blockquote>
<p>これはwebサービスというか、クイズみたいwebページ. 指紋の写真を1枚と20枚とを表示され、一致する (同一人物の同じ指の指紋) がどれかを当てる、というクイズを10問正解するとAttackフラグが1つ得られ、加えて5問正解するとDefenceフラグを書き込む権利が得られる？？ 15問なので気合を入れればどうにかなるかもしれないだろうが、Defence フラグは5分ごとに新しくということは、5分ごとに15問を正解して新しく書き直さないといけないことを意味している.</p>
<blockquote>
<figure>
<img src="https://i.imgur.com/sjWMnGx.png" />
</figure>
</blockquote>
<p>二人で協力することで、10問を人力で解くことに成功し、Attackフラグは得た. 自動化でかなり苦戦した. 試したのは、次の方法:</p>
<ol type="1">
<li>問題セットを大量に仕入れる
<ul>
<li>&quot;New challenge&quot; を何度も繰り返してページに表示された画像のセットを記録する</li>
<li>1つのクイズは、一枚の画像 <span class="math inline">\(X\)</span> に対して、20枚の画像のセット Ys</li>
<li><span class="math inline">\(X\)</span> と同じ指紋を <span class="math inline">\(Ys\)</span> から探す (<span class="math inline">\(X&#39;\)</span> とする)</li>
</ul></li>
<li>仮定、<span class="math inline">\(X\)</span> に対して <span class="math inline">\(Ys\)</span> はランダムに選ばれる. そこにある一枚 <span class="math inline">\(X&#39;\)</span> が常に含まれる</li>
<li>問題セットから ある <span class="math inline">\(X\)</span> について <span class="math inline">\((X, Ys_1), (X, Ys_2), \ldots\)</span> を選ぶ</li>
<li>集合の積 <span class="math inline">\(Ys&#39; \equiv Ys_1 \cap Ys_2 \cap \cdots\)</span> の中に X' が含まれる</li>
<li>特に <span class="math inline">\(|Ys&#39;|=1\)</span> なら、<span class="math inline">\(Ys&#39; = \{X&#39;\}\)</span> である</li>
</ol>
<p>初め、時間を掛けて問題セットを集め、 <span class="math inline">\((X, Ys&#39;)\)</span> の組で解こうとしていたが、未知の <span class="math inline">\(X\)</span> ばかりが出現することに気づいた. チームメンバーから、問題のセットは時間ごとに異なる 500 枚が使われているのではないかという指摘を受け、問題セットを一旦空にして、改めて問題セットを集め直すと、20分程度で、500枚の <span class="math inline">\((X_i, X_i&#39;)\)</span> が手に入ってしまった. チームメンバーはそれを元に、Greasemonkeyのスクリプトを書いて、ブラウザ上で自動化した. しかし我々は結局Defenceスコアを手に入れることはできなかった. システムが壊されており、15問に正解した時点での処理 (おそらく、Defenceフラグを書き込めるようにするためのセッションが発行される) でサーバ側のエラーが発生した. また、強引にDefenceフラグを書き込もうとすると (エラーは出たが処理は済んでいると踏んで)、「今のDefenceフラグは何秒保護されている、5回連続でまた15問正解すると、秒数を減らせる」というメッセージが出る. どうもこのシステムにおけるDefenceフラグはただ1つしか同時に存在できないらしく、書き込んだフラグは期限で保護されるらしい. 他のチームが解けば秒数を減らせるが、逆に自分のチームが解くと秒数を増やせるらしい. おそらく、この指紋認証システムの自動化に成功したチームはほとんど無かった. 我々1チームだけでは到底減らせない秒数に膨れ上がっていた.</p>
<h2 id="梅田">梅田</h2>
<p><a href="http://umeda.koth.seccon/">InSECtagram</a> という Instagram のような web サービス.</p>
<ul>
<li>username と password のペアだけでアカウントが発行できる.</li>
<li>画像をアップロードでき公開できる.</li>
<li>画像のページで like ができる</li>
<li>画像のページで report (adminへの報告) ができる</li>
<li>画像のページでコメントができる</li>
<li><code>/most-liked</code> というエンドポイントはある画像のページを指している
<ul>
<li>文字通り、like がもっとも多い画像ページを指している</li>
<li>ただしこのページからコメントはできない</li>
</ul></li>
</ul>
<p>問題のルールに、 <code>/most-liked</code> がフラグページであることが書いてある. このページのタイトルが1つ目のAttackフラグだった. Defenceフラグはこのページのコメントに書き込めばよい. ただしこのページにコメント欄がないので、指してる画像ページに一旦行ってから、書き込めばよい.</p>
<blockquote>
<figure>
<img src="https://i.imgur.com/v1VJDB8.png" />
</figure>
</blockquote>
<p>コメントを書き込むとか、あるいはそもそもスコアサーバから Defence フラグを取得するとかいうのを私は puppeteer で行った、が、安定性がなくて辛かった. ページ遷移の後に十分な sleep を挟まないといけない. sleep が足りないと嫌なエラーが出る. そして十分は sleep というのは1秒とかするので、結果としてかなり遅い. 最後の方は、一回の書き込みに2秒程度かかるプログラムを8個程度並列で動かしてごまかしたが、他チームの書き込み速度に全く追いついていなかった.</p>
<p>梅田はやることがはっきりしているので、早い段階からDefenceで稼げた. アカウントを作成してlikeするというプログラムも作って <code>/most-liked</code> の参照先を動かして他チームを晦ますといった手法 (参照先を決め打ちしてコメントしているチームもいた) も、最初の方は通用した.</p>
<footer>
    <p class="is-pulled-right">
    @cympfh / cympfh@gmail.com
    </p>
</footer>
<!--

  以下を埋め込むと H2 タグを列挙してそれぞれへのリンクにする.
  ただし "INDEX" は除外する.

    <div id=toc></div>


  H2, H3 タグまでを列挙するには以下を埋め込む.

    <div id=toc-level-2></div>

-->
<script>
(function() {

  function naming(obj, name) {
      var PREF = document.createElement('a');
      PREF.name = name;
      obj.appendChild(PREF);
  }

  function level1() {

    var sections = document.getElementsByTagName('h2');
    var OL = document.createElement('ol');
    for (var i=0; i < sections.length; ++i) {
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = sections[i].innerHTML;
      if (A.innerHTML.toUpperCase() == 'INDEX') continue;
      A.href = '#' + i;
      LI.appendChild(A);
      OL.appendChild(LI);
      naming(sections[i], i);
      // var PREF = document.createElement('a');
      // PREF.name = i;
      // sections[i].appendChild(PREF);
    }

    return OL;
  }

  function level2() {

    var sections = document.querySelectorAll('h2,h3');
    var tree = [];
    for (var i = 0; i < sections.length; ++i) {
      if (sections[i].tagName == 'H2') {
        if (sections[i].innerHTML.toUpperCase() === 'INDEX') continue;
        tree.push([sections[i]]);
      } else {
        if (tree.length > 0) {
          tree[tree.length-1].push(sections[i]);
        } else {
          tree.push([sections[i]]);
        }
      }
    }

    var OL = document.createElement('ol');
    for (var i = 0; i < tree.length; ++i) {

      // h2-level
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = tree[i][0].innerHTML;
      A.href = '#' + i;
      naming(tree[i][0], i);
      LI.appendChild(A);

      // h3-level
      if (tree[i].length > 1) {
        var OL_sub = document.createElement('ol');
        for (var j = 1; j < tree[i].length; ++j) {
          var LI_sub = document.createElement('li');
          var A = document.createElement('a');
          A.innerHTML = tree[i][j].innerHTML;
          A.href = `#${i}-${j}`;
          naming(tree[i][j], `${i}-${j}`);
          LI_sub.appendChild(A);
          OL_sub.appendChild(LI_sub);
        }
        LI.appendChild(OL_sub);
      }

      OL.appendChild(LI);
    }

    return OL;
  }

  function append_toc() {
    if (document.getElementById('toc')) {
      document.getElementById('toc').appendChild(level1());
    }
    if (document.getElementById('toc-level-2')) {
      document.getElementById('toc-level-2').appendChild(level2());
    }
  }

  window.addEventListener('DOMContentLoaded', append_toc, false);
}());
</script>
  <script src="../../../resources/js/youtube.js"></script>
</body>
</html>
