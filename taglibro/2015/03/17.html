<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Tue Mar 17 16:42:34 JST 2015</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="../../../resources/css/c.css">
  <link rel="stylesheet" href="../../css/post.css">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<a href="../../">ğŸ”™ Back to Top</a>
<header>
<h1 class="title">Tue Mar 17 16:42:34 JST 2015</h1>
</header>
<h2 id="vim-ã§ç·¨é›†ã—ãªãŒã‚‰é€”ä¸­çµŒéã‚’ç›£è¦–ã—ãŸã„">vim ã§ç·¨é›†ã—ãªãŒã‚‰é€”ä¸­çµŒéã‚’ç›£è¦–ã—ãŸã„</h2>
<ul>
<li>markdown</li>
<li>gnuplot</li>
<li>dotè¨€èª</li>
</ul>
<p>ã“ã‚Œã‚‰ã¯vimã§ç·¨é›†ã—ãªãŒã‚‰ã‚‚é€ä¸€ã€é€”ä¸­çµŒéã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ« (ã¾ãŸã¯å¤‰æ›) ã—ã¦ã€ ãã®çµæœã‚’çœºã‚ãŸã„</p>
<h3 id="markdown">markdown</h3>
<p>pandoc ã‚’ç”¨ã„ã¦ã€htmlã¾ãŸã¯pdfã«å¤‰æ›ã—ãŸã„<br />
htmlã«å¤‰æ›ã—ã¦è¦‹ã‚‹ã ã‘ã§ã‚‚è„³å†…ã§pdfã«å¯¾å¿œä»˜ã‘ã•ã›ã‚‹ã“ã¨ã¯å®¹æ˜“</p>
<h3 id="gnuplot">gnuplot</h3>
<p>pngç”»åƒã‚’å‡ºåŠ›ã•ã›ãŸã„</p>
<h3 id="dotè¨€èª">dotè¨€èª</h3>
<p>pngç”»åƒã‚’å‡ºåŠ›ã•ã›ãŸã„<br />
Linuxãªã‚‰ã°ã€<code>graphviz</code> ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã„ã‚Œã‚‹ã¨ <code>vimdot</code> ãŒä»˜ã„ã¦ãã‚‹ã®ã§ã€<br />
ã“ã‚Œã‚’ä½¿ã†ã®ãŒæ‰‹ã£å–ã‚Šæ—©ã„</p>
<h2 id="ä½œã£ãŸ">ä½œã£ãŸ</h2>
<div class="sourceCode"><pre class="sourceCode coffee"><code class="sourceCode coffee"><span class="co"># watch.coffee</span>
fs        <span class="kw">=</span> require <span class="st">&#39;fs&#39;</span>
path      <span class="kw">=</span> require <span class="st">&#39;path&#39;</span>
socket_io <span class="kw">=</span> require <span class="st">&#39;socket.io&#39;</span>
http      <span class="kw">=</span> require <span class="st">&#39;http&#39;</span>
express   <span class="kw">=</span> require <span class="st">&#39;express&#39;</span>

<span class="co"># make server</span>
app    <span class="kw">=</span> express<span class="kw">()</span>
server <span class="kw">=</span> http<span class="kw">.</span>Server app
io     <span class="kw">=</span> socket_io server

app<span class="kw">.</span>get <span class="st">&#39;/&#39;</span><span class="kw">,</span> <span class="fu">(req, res) -&gt;</span>
  res<span class="kw">.</span>writeHead <span class="dv">200</span><span class="kw">,</span> <span class="st">&#39;Content-Type&#39;</span><span class="kw">:</span> <span class="st">&#39;text/html&#39;</span>
  res<span class="kw">.</span>end <span class="st">&#39;&#39;&#39;</span>
<span class="st">&lt;title&gt;preview&lt;/title&gt;</span>
<span class="st">&lt;script src=&quot;/socket.io/socket.io.js&quot;&gt;&lt;/script&gt;</span>
<span class="st">&lt;body&gt;&lt;div id=&#39;win&#39;&gt;&lt;/div&gt;</span>
<span class="st">&lt;script&gt;</span>
<span class="st">var socket = io.connect(&quot;http://127.0.0.1&quot;); </span>
<span class="st">socket.on(&#39;change&#39;, function (data) {</span>
<span class="st">    win.innerHTML = data;</span>
<span class="st">    });</span>
<span class="st">&lt;/script&gt;</span>
<span class="st">&#39;&#39;&#39;</span>

app<span class="kw">.</span>get <span class="st">/local\/.*/</span><span class="kw">,</span> <span class="fu">(req, res) -&gt;</span>
  filename <span class="kw">=</span>
    req<span class="kw">.</span>url
      <span class="kw">.</span>replace <span class="st">/^\/local\//</span><span class="kw">,</span> <span class="st">&#39;&#39;</span>
      <span class="kw">.</span>replace <span class="st">/\?.*$/</span><span class="kw">,</span> <span class="st">&#39;&#39;</span>
  res<span class="kw">.</span>sendFile path<span class="kw">.</span>resolve filename

server<span class="kw">.</span>listen <span class="dv">80</span><span class="kw">,</span> <span class="kw">(</span><span class="fu">-&gt;</span><span class="kw">)</span>
io<span class="kw">.</span>listen server

<span class="co"># read configure</span>
conf <span class="kw">=</span> require <span class="st">&quot;./</span><span class="ch">#{</span>process.argv[2]<span class="ch">}</span><span class="st">.coffee&quot;</span>

<span class="co"># socket</span>
gsocket <span class="kw">=</span> <span class="ot">false</span>

emit <span class="kw">=</span> <span class="fu">-&gt;</span>
  <span class="kw">unless</span> gsocket
    <span class="kw">return</span>
  <span class="ot">console</span><span class="kw">.</span>log <span class="st">&#39;emit&#39;</span><span class="kw">,</span> gsocket<span class="kw">.</span>id
  conf<span class="kw">.</span>compile <span class="fu">(err, data) -&gt;</span>
    <span class="kw">throw</span> err <span class="kw">if</span> err
    <span class="ot">console</span><span class="kw">.</span>log data
    gsocket<span class="kw">.</span>emit <span class="st">&#39;change&#39;</span><span class="kw">,</span> data

io<span class="kw">.</span>sockets<span class="kw">.</span><span class="ot">on</span> <span class="st">&#39;connection&#39;</span><span class="kw">,</span> <span class="fu">(socket) -&gt;</span>
  gsocket <span class="kw">=</span> socket
  <span class="kw">do</span> emit

<span class="co"># watch the file</span>
fs<span class="kw">.</span>exists conf<span class="kw">.</span>srcfile<span class="kw">,</span> <span class="fu">(bl) -&gt;</span>
  <span class="kw">unless</span> bl
    <span class="ot">console</span><span class="kw">.</span>log <span class="st">&quot;</span><span class="ch">#{</span>conf.srcfile<span class="ch">}</span><span class="st"> not exists&quot;</span>
    process<span class="kw">.</span>exit <span class="dv">0</span>
  fs<span class="kw">.</span>watchFile conf<span class="kw">.</span>srcfile<span class="kw">,</span> <span class="kw">{</span>interval<span class="kw">:</span><span class="dv">300</span><span class="kw">},</span> <span class="fu">(event) -&gt;</span>
    <span class="ot">console</span><span class="kw">.</span>log event
    <span class="kw">do</span> emit</code></pre></div>
<p>åˆ¥é€”ã€ç›£è¦–å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã€ãã‚Œã‚’ã©ã†å‡¦ç†ã™ã‚‹ã‹ã‚’æ›¸ã„ãŸè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã™ã‚‹<br />
ãƒ•ã‚¡ã‚¤ãƒ«åã¯å…ã‚‚è§’ã€å‡¦ç†ã¯é–¢æ•°ã§æ›¸ãã—ã‹ãªã„ã®ã§<br />
å®Ÿç”¨ä¸Šã€CoffeeScriptã‹JavaScriptã§æ›¸ãã—ã‹ãªã„<br />
å¾“ã£ã¦ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Ÿéš›ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚ã‚‹</p>
<h3 id="markdown.coffee">markdown.coffee</h3>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">fs <span class="fu">=</span> require <span class="ch">&#39;fs&#39;</span>
{exec} <span class="fu">=</span> require <span class="ch">&#39;child_process&#39;</span>

srcfile <span class="fu">=</span> <span class="ch">&#39;./test.md&#39;</span>

compile <span class="fu">=</span> (cont) <span class="ot">-&gt;</span>
  exec <span class="st">&quot;pandoc -s -t html5 -i #{srcfile} -o test.html&quot;</span>, (err) <span class="ot">-&gt;</span>
    console<span class="fu">.</span>warn err <span class="kw">if</span> err
    fs<span class="fu">.</span>readFile <span class="ch">&#39;./test.html&#39;</span>, <span class="ch">&#39;utf8&#39;</span>, (err, <span class="kw">data</span>) <span class="ot">-&gt;</span>
      throw err <span class="kw">if</span> err
      cont false, <span class="kw">data</span>

<span class="kw">module</span><span class="fu">.</span>exports <span class="fu">=</span>
  srcfile<span class="fu">:</span> srcfile
  compile<span class="fu">:</span> compile</code></pre></div>
<ul>
<li>srcfile ã«ç›£è¦–å¯¾è±¡ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å®šç¾©ã™ã‚‹</li>
<li>å¤‰æ›´ãŒã‚ã£ãŸæ™‚ã®å‡¦ç†ã‚’ç¶™ç¶šã‚’å–ã‚‹æ‰‹ç¶šãã®å½¢ã§å®šç¾©ã™ã‚‹ (compile)
<ul>
<li>ç¶™ç¶šã®ç¬¬ä¸€å¼•æ•°ã¯ã‚¨ãƒ©ãƒ¼ã§ã€ç¬¬äºŒå¼•æ•°ã«ã€htmlã¨ã—ã¦è§£é‡ˆå¯èƒ½ãªæ–‡å­—åˆ—</li>
</ul></li>
</ul>
<h3 id="gnuplot.coffee">gnuplot.coffee</h3>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">{exec} <span class="fu">=</span> require <span class="ch">&#39;child_process&#39;</span>

srcfile <span class="fu">=</span> <span class="ch">&#39;test.plt&#39;</span>
compile <span class="fu">=</span> (cont) <span class="ot">-&gt;</span>
  exec <span class="st">&quot;gnuplot #{srcfile}&quot;</span>, (err) <span class="ot">-&gt;</span>
    console<span class="fu">.</span>warn err <span class="kw">if</span> err
    cont err, <span class="st">&quot;&lt;img src=local/test.png?#{Math.random()}&gt;&quot;</span>

<span class="kw">module</span><span class="fu">.</span>exports <span class="fu">=</span>
  srcfile<span class="fu">:</span> srcfile
  compile<span class="fu">:</span> compile</code></pre></div>
<ul>
<li><code>src=local/hoge/fuga</code> ã§ <code>path.resolvec 'hoge/fuga'</code> ã‚’è¿”ã™</li>
<li>ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç”¨æ„ã«åŠ¹ã„ã¦ã—ã¾ã†ã®ã§ <code>?Math.random()</code> ã‚’ã¤ã‘ã‚‹</li>
</ul>
<h3 id="dot.coffee">dot.coffee</h3>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">{exec} <span class="fu">=</span> require <span class="ch">&#39;child_process&#39;</span>

srcfile <span class="fu">=</span> <span class="ch">&#39;./test.dot&#39;</span>

compile <span class="fu">=</span> (cont) <span class="ot">-&gt;</span>
  exec <span class="ch">&#39;dot -Tpng test.dot &gt; test.png&#39;</span>, (err) <span class="ot">-&gt;</span>
    console<span class="fu">.</span>warn err <span class="kw">if</span> err
    cont err, <span class="st">&quot;&lt;img src=local/test.png?#{Math.random()}&gt;&quot;</span>

<span class="kw">module</span><span class="fu">.</span>exports <span class="fu">=</span>
  srcfile<span class="fu">:</span> srcfile
  compile<span class="fu">:</span> compile</code></pre></div>
<ul>
<li>gnuplot ã®å ´åˆã¨å…¨ãåŒæ§˜</li>
</ul>
<h3 id="python.coffee">python.coffee</h3>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">fs <span class="fu">=</span> require <span class="ch">&#39;fs&#39;</span>
{exec} <span class="fu">=</span> require <span class="ch">&#39;child_process&#39;</span>

srcfile <span class="fu">=</span> <span class="ch">&#39;./test.py&#39;</span>

compile <span class="fu">=</span> (cont) <span class="ot">-&gt;</span>
  exec <span class="st">&quot;python #{srcfile} &gt; out&quot;</span>, (err) <span class="ot">-&gt;</span>
    console<span class="fu">.</span>warn err <span class="kw">if</span> err
    fs<span class="fu">.</span>readFile <span class="ch">&#39;./out&#39;</span>, <span class="ch">&#39;utf8&#39;</span>, (err, <span class="kw">data</span>) <span class="ot">-&gt;</span>
      throw err <span class="kw">if</span> err
      cont false, <span class="kw">data</span><span class="fu">.</span>replace <span class="fu">/</span>\n<span class="fu">/</span>g, <span class="ch">&#39;&lt;br&gt;&#39;</span>

<span class="kw">module</span><span class="fu">.</span>exports <span class="fu">=</span>
  srcfile<span class="fu">:</span> srcfile
  compile<span class="fu">:</span> compile</code></pre></div>
<ul>
<li>htmlã¨ã—ã¦å‡ºåŠ›ã™ã‚‹ã®ã§æ”¹è¡Œã ã‘ã¡ã‚‡ã£ã¨</li>
</ul>
<h2 id="usage">usage</h2>
<p><code>watch.coffee</code> ã¨ <code>conf.coffee</code> ã¨ã€ç›£è¦–å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒå…¨éƒ¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ã“ã¨ã«ã—ã¦ã‚‹<br />
ã¾ãŸã€é–‹å§‹æ™‚ã« ç›£è¦–å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ—¢ã«å­˜åœ¨ã—ã¦ã‚‹ã“ã¨ã«ã—ã¦ã‚‹</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">sudo</span> coffee watch.coffee conf</code></pre></div>
<p>ä¾‹ãˆã°ã€<code>python.coffee</code> ãªã‚‰</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">touch</span> test.py
<span class="fu">sudo</span> coffee watch.coffee python</code></pre></div>
<p>ã¨ã“ã†ã—ã¦ã€ åˆ¥ãªçª“ã§ <code>test.py</code> ã‚’ç·¨é›†ã™ã‚‹<br />
ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ãŒãƒã‚§ãƒƒã‚¯å‡ºæ¥ã‚‹ã®ã¯ä¿å­˜æ™‚ã ã‹ã‚‰ã€ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ãŸç¬é–“ã« <code>python test.py &gt; out</code> ãŒèµ°ã‚‹</p>
<p>ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®çµæœã¯ã€ ãƒ–ãƒ©ã‚¦ã‚¶ã§ <code>http://127.0.0.1/</code> ã‚’é–‹ãã“ã¨ã§ç¢ºèªã™ã‚‹</p>
<h2 id="ä»–">ä»–</h2>
<p><code>fs.watch</code> ã¨ <code>fs.watchFile</code> ã¨ãŒã‚ã£ã¦ã€ äºŒã¤ã¨ã‚‚ç›®çš„ã¯åŒã˜ã§ã‚ã‚‹<br />
æ‰‹å…ƒã®Macã§ã¯ <code>fs.watch</code> ã¯æ˜ã‚‰ã‹ã«ä¿¡ç”¨ã§ããªã„æŒ™å‹•ã§ã‚ã£ãŸ<br />
è©³ã—ãã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</p>
<p>ã“ã‚“ã ã‘ãªã‚‰ã‚ã–ã‚ã–ã€ã“ã‚“ãªsocket.ioã¾ã§ä½¿ã£ã¦é¢å€’ãªã“ã¨ã—ãªã„ã§ã‚‚<br />
ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ãã‚‹ã£ã¦ã„ã†htmlæ›¸ã‘ã°ã„ã„ã®ã§ã‚</p>
</body>
</html>
