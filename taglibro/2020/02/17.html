<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="description" content="cympfh.cc/taglibro" />
  <meta property="og:url" content="http://cympfh.cc/taglibro">
  <meta property="og:title" content="Mon Feb 17 2020" />
  <meta property="og:description" content="cympfh.cc/taglibro" />
  <meta property="og:image" content="http://cympfh.cc/resources/img/identicon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@cympfh" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Mon Feb 17 2020</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="../../../resources/css/c.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
</head>
<body>
<header class="page-header">
    <a href='../../index.html'><i class="fa fa-save" style="position:absolute; left:0.4em; top:0.4em; width:1.3em;border-radius:0.8em;"></i></a>
</header>
<header>
<h1 class="title">Mon Feb 17 2020</h1>
</header>
<h2 id="urxvt-に乗り換えたり色々した">urxvt に乗り換えたり色々した</h2>
<p>2020年にもなってようやく家の Ubuntu 14.04LTS を 16.04LTS にアップグレードした. そしたらいくつか動かなくなったものが出てきたのでせっかくなので新しい環境に順応することにした. あとニヶ月したらまた新しい環境が来るんだけど.</p>
<h3 id="ime">IME</h3>
<p>毎回なんだけど ubuntu のアップグレードのたびに IME は死ぬ気がする. ibus か fcitx かを毎回試したりする. 一旦全部消して, Ubuntuが提供する Unity デスクトップ環境にログインして行儀よくGUIの設定画面からポチポチするのが一番早い. 14.04 では fcitx を使ってたけど, 今は ibus が使われている. Mozc はいつも, 起動したては &quot;Input Mode&quot; が &quot;Direct&quot; になっていて, これを手で &quot;Hiragana&quot; にしないと普通の日本語入力に出来ないんだけど, これを勝手にやってくれる方法が未だ分からん.</p>
<h3 id="terminal">Terminal</h3>
<p><code>gnome-terminal</code> とか <code>terminator</code> とか使ってて, 普通には全然使えるんだけど, <code>w3m-img</code> でターミナル上に画像を表示する機能が死んでしまった. ほとんどの人はそんな機能は興味ないかもだけど, 私はファイラーとして <code>ranger</code> を使ってるのでとても困る. 本当はちゃんと画像があれば画像のプレビューが右側に表示されるのが何も表示されなくなった. 今まではなんで動いてたのかよくわからないけど, しょうがないので <code>ranger</code> 公式がサポートを謳ってるターミナルの１つである <code>urxvt</code> を使うことにした. <code>ranger</code> だけ <code>urxvt</code> で他は違うターミナルで〜, というのもなんだか変なので, 本格的にこれに乗り換えることを考える.</p>
<p>何も考えずに</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">sudo</span> apt install rxvt-unicode-256color
<span class="ex">rxvt</span></code></pre></div>
<p>で起動すると, ちっちゃい画面にカクカクの文字でプロンプトが表示されるだけで日本語も打てないで使い物にならない. 起動時のオプションでフォントやら色設定を渡すことができるが, 普通は <code>~/.Xresources</code> に設定を列挙して使うらしい. また単体で起動することもできるけど, 一個デーモンを起動しておいてターミナルはこれにアタッチして起動する使い方が推奨されてるのかなんなのか分からんが, 省メモリで良いらしいので, 郷に従うことにする.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">urxvtd</span> -q -o -f  # start daemon
<span class="ex">urxvtc</span>  # attach a new terminal</code></pre></div>
<p><code>urxvtc</code> はアタッチして起動するコマンドで, デーモンが起動してない状態でこれをやると エラーコード <code>2</code> で異常終了するので, それを利用するとデーモンを無駄に起動しすぎないことができる. つまり,</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">urxvtc</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span>
<span class="kw">if</span><span class="bu"> [</span> <span class="va">$?</span> <span class="ot">-eq</span> 2<span class="bu"> ]</span>; <span class="kw">then</span>
  <span class="ex">urxvtd</span> -q -o -f
  <span class="ex">urxvtc</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span>
<span class="kw">fi</span></code></pre></div>
<p>これを私は適当なスクリプトファイルにして保存してこれを起動コマンドにした.</p>
<figure>
<img src="https://i.imgur.com/Dc7FTrb.png" />
</figure>
<p>さて, まだ何の設定もしてないと, フォントはカクカクだし色設定も目に痛いし, 日本語は打てないしクリップボードもタブも使えない. フォントと色設定とIMEの問題は初めからの設定でなんとかなる. クリップボードとタブについては Perl によるプラグイン拡張で対応する.</p>
<p>そう, このターミナルは Perl で拡張するスタイルのようで, <code>~/.urxvt/ext/</code> の下に Perl スクリプト（拡張子なし）で保存するとそれを設定できるようになる. タブに関しては <code>tabbed</code> という名前のプラグインが標準で入っている. クリップボードについては, Arch Wiki だと <code>clipboard</code> という名前で標準に入ってるように書いてあるが, 私の環境だと入ってなかった. <a href="https://github.com/muennich/urxvt-perls">github.com/muennich/urxvt-perls</a> の <code>deprecated/</code> 以下にそれがあるので, スクリプトファイルだけをさっき述べたディレクトリに置けば設定出来るようになる.</p>
<p>というわけで現時点の設定ファイルを以下に載せる. と言ってもこれはインターネット上に散らばっていた色んな設定ファイルを私なりにマージしただけのものです.</p>
<pre class="xdefaults"><code>!! ~/.Xresources

Xcursor.theme: ycursors
Xcursor.size: 64

!!
!! rxvt-unicode (urxvt)
!!

URxvt.geometry:             96x32
URxvt.scrollBar_right:      true
URxvt.scrollBar_floating:   true
URxvt.scrollstyle:          plain
URxvt.cursorBlink:          true
URxvt.cursorUnderline:      true
URxvt.pointerBlank:         true
URxvt.visualBell:           true
URxvt.saveLines:            3000
URxvt.fading:               40

!! 使うプラグインの列挙
URxvt.perl-ext-common: clipboard,url-select,keyboard-select,tabbed

!! clipboard
URxvt.clipboard.autocopy: true
URxvt.copyCommand: xclip -i -selection clipboard
URxvt.pasteCommand: xclip -o -selection clipboard
URxvt.keysym.M-c: perl:clipboard:copy
URxvt.keysym.M-v: perl:clipboard:paste
URxvt.keysym.M-C-v: perl:clipboard:paste_escaped
URxvt.keysym.M-Escape: perl:keyboard-select:activate
URxvt.keysym.M-s: perl:keyboard-select:search
URxvt.keysym.M-u: perl:url-select:select_next
URxvt.urlLauncher: firefox
URxvt.underlineURLs: true
URxvt.urlButton: 1

!! tabbed
URxvt.tabbed.tabbar-fg: 2
URxvt.tabbed.tabbar-bg: 0
URxvt.tabbed.tab-fg: 3
URxvt.tabbed.tab-bg: 0

!! IME
URxvt.inputMethod: ibus
URxvt.preeditType: OverTheSpot
!! ibus-daemon の起動コマンドに --xim を付け加える必要あり

!! Font list and Spacing
URxvt.font:                 xft:Dejavu Sans Mono-15,\
                            xft:IPAGothic
URxvt.letterSpace:          -1
!URxvt.lineSpace:            0

!! Color Scheme and Opacity - gruvbox-dark https://github.com/morhetz/gruvbox
URxvt.depth:                32
URxvt.color0:               [90]#282828
URxvt.color1:               [90]#cc241d
URxvt.color2:               [90]#98971a
URxvt.color3:               [90]#d79921
URxvt.color4:               [90]#458588
URxvt.color5:               [90]#b16286
URxvt.color6:               [90]#689d6a
URxvt.color7:               [90]#a89984
URxvt.color8:               [90]#928374
URxvt.color9:               [90]#fb4934
URxvt.color10:              [90]#b8bb26
URxvt.color11:              [90]#fabd2f
URxvt.color12:              [90]#83a598
URxvt.color13:              [90]#d3869b
URxvt.color14:              [90]#8ec07c
URxvt.color15:              [90]#ebdbb2
URxvt.foreground:           [90]#ebdbb2
URxvt.background:           [90]#282828
URxvt.colorIT:              [90]#8ec07c
URxvt.colorBD:              [90]#d5c4a1
URxvt.colorUL:              [90]#83a598
URxvt.scrollColor:          [90]#504945
!URxvt.troughColor:          [90]#3C3836</code></pre>
<p>さて今も urxvt でブログを書いているが, IME 周りはなんだか不安定だ. 「な」を打つために &quot;na&quot; と打ったのに &quot;n&quot; の時点で一度勝手に確定がはいって「ｎあ」となるような現象がしばしばあった. 一度ウィンドウのフォーカスを他に移してからまた戻すと治る, ということがわかった. しかし誰が悪いのか分かってない.</p>
<h3 id="追記---ranger-の-image-preview">追記 - ranger の image preview</h3>
<p>現時点で ranger の 1.9.0b5 を使っている. <code>~/.config/ranger/rc.conf</code> で <code>set preview_images true</code> としてさえいればプレビュー機能は有効になり, urxvt で実際にプレビューは見れる. のだが, 崩れる. カーソルのある行から崩れる. 念の為に <code>set preview_images_method urxvt</code> を設定に付け加えると, これは完全に解消された. ついでに, プレビューしてるときだけターミナル全体が透過されるようになったのだが, これは意図した挙動なのか? 見ようによってはおしゃれなので, まあいっか.</p>
<figure>
<img src="https://i.imgur.com/o3qwFot.png" />
</figure>
<h3 id="追記---20200531">追記 - 2020/05/31</h3>
<p>もうこんな意味分からんターミナル使ってない. 使わんほうが良い.</p>
<footer>
    <p class="is-pulled-right">
    @cympfh / mail@cympfh.cc
    </p>
</footer>
<!--

  以下を埋め込むと H2 タグを列挙してそれぞれへのリンクにする.
  ただし "INDEX" は除外する.

    <div id=toc></div>


  H2, H3 タグまでを列挙するには以下を埋め込む.

    <div id=toc-level-2></div>

-->
<script>
(function() {

  function naming(obj, name) {
      var PREF = document.createElement('a');
      PREF.name = name;
      obj.appendChild(PREF);
  }

  function level1() {

    var sections = document.getElementsByTagName('h2');
    var OL = document.createElement('ol');
    for (var i=0; i < sections.length; ++i) {
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = sections[i].innerHTML;
      if (A.innerHTML.toUpperCase() == 'INDEX') continue;
      A.href = '#' + i;
      LI.appendChild(A);
      OL.appendChild(LI);
      naming(sections[i], i);
      // var PREF = document.createElement('a');
      // PREF.name = i;
      // sections[i].appendChild(PREF);
    }

    return OL;
  }

  function level2() {

    var sections = document.querySelectorAll('h2,h3');
    var tree = [];
    for (var i = 0; i < sections.length; ++i) {
      if (sections[i].tagName == 'H2') {
        if (sections[i].innerHTML.toUpperCase() === 'INDEX') continue;
        tree.push([sections[i]]);
      } else {
        if (tree.length > 0) {
          tree[tree.length-1].push(sections[i]);
        } else {
          tree.push([sections[i]]);
        }
      }
    }

    var OL = document.createElement('ol');
    for (var i = 0; i < tree.length; ++i) {

      // h2-level
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = tree[i][0].innerHTML;
      A.href = '#' + i;
      naming(tree[i][0], i);
      LI.appendChild(A);

      // h3-level
      if (tree[i].length > 1) {
        var OL_sub = document.createElement('ol');
        for (var j = 1; j < tree[i].length; ++j) {
          var LI_sub = document.createElement('li');
          var A = document.createElement('a');
          A.innerHTML = tree[i][j].innerHTML;
          A.href = `#${i}-${j}`;
          naming(tree[i][j], `${i}-${j}`);
          LI_sub.appendChild(A);
          OL_sub.appendChild(LI_sub);
        }
        LI.appendChild(OL_sub);
      }

      OL.appendChild(LI);
    }

    return OL;
  }

  function append_toc() {
    if (document.getElementById('toc')) {
      document.getElementById('toc').appendChild(level1());
    }
    if (document.getElementById('toc-level-2')) {
      document.getElementById('toc-level-2').appendChild(level2());
    }
  }

  window.addEventListener('DOMContentLoaded', append_toc, false);
}());
</script>
</body>
</html>
