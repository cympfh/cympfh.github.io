<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Wed Jun 19 2019</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../resources/css/c.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
</head>
<body>
<header class="page-header">
    <a href='../../index.html'><i class="fa fa-save" style="position:absolute; left:0.4em; top:0.4em; width:1.3em;border-radius:0.8em;"></i></a>
</header>
<header>
<h1 class="title">Wed Jun 19 2019</h1>
</header>
<pre><code>      6月 2019         
日 月 火 水 木 金 土  
                   1  
 2  3  4  5  6  7  8  
 9 10 11 12 13 14 15  
16 17 18 19 20 21 22  
23 24 25 26 27 28 29  
30                    </code></pre>
<h2 id="section">06/08-06/09</h2>
<p>会社の同好会で合宿に行った. わざわざ遠出して一泊してやる意味があるか? などと、つい考えてしまう. けど、そういえば、使いみちの無い会社から支給される会費の使いみちが無くてのイベントだったから、しょうがないのだった. 交通費とかは負担したけどな.</p>
<h2 id="diverta-2019-programming-contest-2">06/15 - diverta 2019 Programming Contest 2</h2>
<p>企業コンテストはARC相当であるらしく、私の腕前だと D 問題がギリギリという感じ. でもこれでレーティングが <code>1571 -&gt; 1636</code> で水色から青色になれた.</p>
<h2 id="abc130">06/16 - ABC130</h2>
<p>さすがに昨日の企業コンテストよりは簡単であったが、本当にマグレで全て (A-F) 解けた. 最後の F 問題は本当にマグレで、誤った解法ではあったのに偶然通ってしまった.</p>
<p>F 問題は結局、時刻 <span class="math inline">\(t \geq 0\)</span> に関する2つの凸関数 <span class="math inline">\(f(t), g(t)\)</span> があって、これの積の最小値を求めよという問題だと言える. 私は凸同士の積だから凸になると考えた. いや結構怪しいが、この問題に限ってはなるのかも？と考えた. 競技プログラミングに関しては普通のプログラミングとは違って、メタ的な推論も方法の一つだと思っていて、わたしは「言うてABCなんだし、実は凸でした」というオチを期待したわけである. 凸関数の最小値を求めるには三分探索をすればよい.</p>
<ul>
<li><a href="https://atcoder.jp/contests/abc130/submissions/5979567">abc130/submissions/5979567</a></li>
</ul>
<p>実際には全然凸ではなくて, <span class="math inline">\(f(x) = |x|, g(x) = |x-1|\)</span> なんかを考えると次のような関数が現れる.</p>
<?xml version="1.0" encoding="utf-8"  standalone="no"?>
<svg width="600" height="480" viewBox="0 0 600 480" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>
Gnuplot
</title>
<desc>Produced by GNUPLOT 5.2 patchlevel 6 </desc><g id="gnuplot_canvas"><rect x="0" y="0" width="600" height="480" fill="none"/><defs> <circle id='gpDot' r='0.5' stroke-width='0.5' stroke='currentColor'/> <path id='gpPt0' stroke-width='0.222' stroke='currentColor' d='M-1,0 h2 M0,-1 v2'/> <path id='gpPt1' stroke-width='0.222' stroke='currentColor' d='M-1,-1 L1,1 M1,-1 L-1,1'/> <path id='gpPt2' stroke-width='0.222' stroke='currentColor' d='M-1,0 L1,0 M0,-1 L0,1 M-1,-1 L1,1 M-1,1 L1,-1'/> <rect id='gpPt3' stroke-width='0.222' stroke='currentColor' x='-1' y='-1' width='2' height='2'/> <rect id='gpPt4' stroke-width='0.222' stroke='currentColor' fill='currentColor' x='-1' y='-1' width='2' height='2'/> <circle id='gpPt5' stroke-width='0.222' stroke='currentColor' cx='0' cy='0' r='1'/> <use xlink:href='#gpPt5' id='gpPt6' fill='currentColor' stroke='none'/> <path id='gpPt7' stroke-width='0.222' stroke='currentColor' d='M0,-1.33 L-1.33,0.67 L1.33,0.67 z'/> <use xlink:href='#gpPt7' id='gpPt8' fill='currentColor' stroke='none'/> <use xlink:href='#gpPt7' id='gpPt9' stroke='currentColor' transform='rotate(180)'/> <use xlink:href='#gpPt9' id='gpPt10' fill='currentColor' stroke='none'/> <use xlink:href='#gpPt3' id='gpPt11' stroke='currentColor' transform='rotate(45)'/> <use xlink:href='#gpPt11' id='gpPt12' fill='currentColor' stroke='none'/> <path id='gpPt13' stroke-width='0.222' stroke='currentColor' d='M0,1.330 L1.265,0.411 L0.782,-1.067 L-0.782,-1.076 L-1.265,0.411 z'/> <use xlink:href='#gpPt13' id='gpPt14' fill='currentColor' stroke='none'/> <filter id='textbox' filterUnits='objectBoundingBox' x='0' y='0' height='1' width='1'> <feFlood flood-color='white' flood-opacity='1' result='bgnd'/> <feComposite in='SourceGraphic' in2='bgnd' operator='atop'/> </filter> <filter id='greybox' filterUnits='objectBoundingBox' x='0' y='0' height='1' width='1'> <feFlood flood-color='lightgrey' flood-opacity='1' result='grey'/> <feComposite in='SourceGraphic' in2='grey' operator='atop'/> </filter></defs><g fill="none" color="white" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,444.0 L62.9,444.0 M575.0,444.0 L566.0,444.0  '/> <g transform="translate(45.6,447.9)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,390.8 L62.9,390.8 M575.0,390.8 L566.0,390.8  '/> <g transform="translate(45.6,394.7)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.1</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,337.5 L62.9,337.5 M575.0,337.5 L566.0,337.5  '/> <g transform="translate(45.6,341.4)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.2</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,284.3 L62.9,284.3 M575.0,284.3 L566.0,284.3  '/> <g transform="translate(45.6,288.2)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.3</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,231.0 L62.9,231.0 M575.0,231.0 L566.0,231.0  '/> <g transform="translate(45.6,234.9)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.4</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,177.8 L62.9,177.8 M575.0,177.8 L566.0,177.8  '/> <g transform="translate(45.6,181.7)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.5</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,124.6 L62.9,124.6 M575.0,124.6 L566.0,124.6  '/> <g transform="translate(45.6,128.5)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.6</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,71.3 L62.9,71.3 M575.0,71.3 L566.0,71.3  '/> <g transform="translate(45.6,75.2)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.7</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,18.1 L62.9,18.1 M575.0,18.1 L566.0,18.1  '/> <g transform="translate(45.6,22.0)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text><tspan font-family="Arial" > 0.8</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,444.0 L53.9,435.0 M53.9,18.1 L53.9,27.1  '/> <g transform="translate(53.9,465.9)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="middle"> <text><tspan font-family="Arial" >-0.5</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M184.2,444.0 L184.2,435.0 M184.2,18.1 L184.2,27.1  '/> <g transform="translate(184.2,465.9)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="middle"> <text><tspan font-family="Arial" > 0</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M314.5,444.0 L314.5,435.0 M314.5,18.1 L314.5,27.1  '/> <g transform="translate(314.5,465.9)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="middle"> <text><tspan font-family="Arial" > 0.5</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M444.7,444.0 L444.7,435.0 M444.7,18.1 L444.7,27.1  '/> <g transform="translate(444.7,465.9)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="middle"> <text><tspan font-family="Arial" > 1</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M575.0,444.0 L575.0,435.0 M575.0,18.1 L575.0,27.1  '/> <g transform="translate(575.0,465.9)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="middle"> <text><tspan font-family="Arial" > 1.5</tspan></text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,18.1 L53.9,444.0 L575.0,444.0 L575.0,18.1 L53.9,18.1 Z  '/></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"></g> <g id="gnuplot_plot_1" >
<title>
abs(x) * abs(x-1)
</title>
<g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <g transform="translate(507.9,40.0)" stroke="none" fill="black" font-family="Arial" font-size="12.00"  text-anchor="end"> <text>abs(x) * abs(x-1)</text> </g></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='rgb(148,   0, 211)'  d='M516.2,36.1 L558.4,36.1 M53.9,44.7 L59.2,66.0 L64.4,86.9 L69.7,107.3 L75.0,127.3 L80.2,146.8      L85.5,166.0 L90.7,184.6 L96.0,202.9 L101.3,220.7 L106.5,238.1 L111.8,255.0 L117.1,271.6 L122.3,287.6        L127.6,303.3 L132.9,318.5 L138.1,333.3 L143.4,347.6 L148.6,361.5 L153.9,375.0 L159.2,388.0 L164.4,400.6     L169.7,412.8 L175.0,424.5 L180.2,435.8 L185.5,441.3 L190.8,430.9 L196.0,420.9 L201.3,411.3 L206.5,402.2     L211.8,393.5 L217.1,385.3 L222.3,377.4 L227.6,370.1 L232.9,363.1 L238.1,356.6 L243.4,350.5 L248.7,344.9     L253.9,339.6 L259.2,334.9 L264.4,330.5 L269.7,326.6 L275.0,323.1 L280.2,320.1 L285.5,317.5 L290.8,315.3     L296.0,313.6 L301.3,312.3 L306.6,311.4 L311.8,311.0 L317.1,311.0 L322.3,311.4 L327.6,312.3 L332.9,313.6     L338.1,315.3 L343.4,317.5 L348.7,320.1 L353.9,323.1 L359.2,326.6 L364.5,330.5 L369.7,334.9 L375.0,339.6     L380.2,344.9 L385.5,350.5 L390.8,356.6 L396.0,363.1 L401.3,370.1 L406.6,377.4 L411.8,385.3 L417.1,393.5     L422.4,402.2 L427.6,411.3 L432.9,420.9 L438.1,430.9 L443.4,441.3 L448.7,435.8 L453.9,424.5 L459.2,412.8     L464.5,400.6 L469.7,388.0 L475.0,375.0 L480.3,361.5 L485.5,347.6 L490.8,333.3 L496.0,318.5 L501.3,303.3     L506.6,287.6 L511.8,271.6 L517.1,255.0 L522.4,238.1 L527.6,220.7 L532.9,202.9 L538.2,184.6 L543.4,166.0     L548.7,146.8 L553.9,127.3 L559.2,107.3 L564.5,86.9 L569.7,66.0 L575.0,44.7  '/></g> </g><g fill="none" color="white" stroke="rgb(148,   0, 211)" stroke-width="2.00" stroke-linecap="butt" stroke-linejoin="miter"></g><g fill="none" color="black" stroke="currentColor" stroke-width="2.00" stroke-linecap="butt" stroke-linejoin="miter"></g><g fill="none" color="black" stroke="black" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"> <path stroke='black'  d='M53.9,18.1 L53.9,444.0 L575.0,444.0 L575.0,18.1 L53.9,18.1 Z  '/></g><g fill="none" color="black" stroke="currentColor" stroke-width="1.00" stroke-linecap="butt" stroke-linejoin="miter"></g></g>
</svg>
<p>ところで最近 modint が流行っている.</p>
<ul>
<li><a href="http://noshi91.hatenablog.com/entry/2019/03/31/174006">modint 構造体を使ってみませんか？ (C++)</a></li>
<li><a href="https://qiita.com/wotsushi/items/c936838df992b706084c">Pythonでmodintを実装してみた</a></li>
</ul>
<p>競技プログラミングにおいて、よくある典型的な形式がある: あまりにも回答する整数が巨大な場合に、ある数 <span class="math inline">\(M\)</span> （これは大抵素数であることが多い）で割った数を求めさせることがよくある. そのような場合、あるコンテクストの計算を全て <span class="math inline">\(\mathbb Z / M \mathbb Z\)</span> という体の上で計算すれば良いことになる（<span class="math inline">\(M\)</span> が素数じゃないと割り算が自由じゃないので体ではなくなるけど）.</p>
<p>というのが背景で、要するに、普通の整数のように四則演算があって、その度に勝手に <span class="math inline">\(\bmod\)</span> を適切に取ってくれるような構造体があると便利. それがないと、いちいち手で</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1">a + b + c - d</a></code></pre></div>
<p>を</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb3-1" title="1">((((a + b) % M) + c) % M + M - d) % M</a></code></pre></div>
<p>などと書かないといけない. どこでオーバーフローするか分からないので毎回 <code>% M</code> をする必要があって、括弧がいくらあっても足りないだろう. 特に減算のときは <code>+ M</code> をするのがポイントだ. 言語に依る話だけど <code>-1 % 3</code> が <code>-1</code> なものもある. そういう場合は <code>(-1 + 3) % 3</code> で <code>2</code> にするのが大抵の場合、期待する値だから.</p>
<p>私は競技プログラミングで Rust を使う人間なので, Rust で実装した:</p>
<ul>
<li><a href="http://cympfh.cc/procon/int.mod.ops.html">int.mod.ops</a></li>
</ul>
<p>しかしながらまだ ABC130 の E 問題でしか試してない. この回答では <code>+=</code>, <code>+</code>, <code>-</code> くらいしか動かしてないので、もしかしたらバグがあるかもしれない. っていうか実際 <code>-</code> にバグがあったのを慌てて修正したし.</p>
<p>あと Rust は型安全に忠実すぎて、四則演算の定義だけでこんなに長くなってしまった. 例えば和については</p>
<pre><code>ModInt + ModInt
ModInt + int
int + ModInt
ModInt += ModInt
ModInt += int</code></pre>
<p>といったものを全て実装しないといけない. せめて <code>+=</code> は <code>+</code> から自動的に derive する機能が欲しい（無いですよね？）</p>
<h2 id="section-1">06/15</h2>
<p>Facebook Hacker Cup の予選があった. 予選は一問でも解けさえすれば良いので、やる気があるかどうかのテストである.</p>
<p><strike> その中の3つ目の問題</p>
<ul>
<li><a href="https://www.facebook.com/hackercup/problem/589264531559040/">Mr.X</a></li>
</ul>
<p><span class="math inline">\(x\)</span> に関する論理式が与えられるので一部を書き換えて, 式全体の値が <span class="math inline">\(x\)</span> の値に依らないようにせよ、という問題. AND, OR, XOR を含む場合、実はそのトップレベルの演算を適切に別の演算に書き換えれば必ず全体の値は不変に出来る、ということに気づく.</p>
<p>例えば <code>a AND b</code> を考える. <code>x=true,false</code> に対して <code>a</code> <code>b</code> それぞれが <code>a=true,false</code>, <code>b=true,true</code> と取る時 <code>a AND b=true,false</code> と取るので値が <code>x</code> に依存していていけない. しかしこのとき <code>AND</code> を <code>OR</code> に置き換えれば <code>a OR b=true,true</code> と出来て不変. このように <code>a</code> <code>b</code> のバリエーションを全通り書き出して、どれかの演算なら不変に出来ることが分かる.</p>
<p>問題は、書き換えなくても不変かどうかである. Facebook の後からの解説によると、部分を見ればそれは分かるらしい. 例えば </strike></p>
<p>問題の解説を書こうと思ったけど、公式の解説なりもっと強い人のを読めばいいのでやめた.</p>
<footer>
    <p class="is-pulled-right">
    @cympfh / cympfh@gmail.com
    </p>
</footer>
<!--

  以下を埋め込むと H2 タグを列挙してそれぞれへのリンクにする.
  ただし "INDEX" は除外する.

    <div id=toc></div>


  H2, H3 タグまでを列挙するには以下を埋め込む.

    <div id=toc-level-2></div>

-->
<script>
(function() {

  function naming(obj, name) {
      var PREF = document.createElement('a');
      PREF.name = name;
      obj.appendChild(PREF);
  }

  function level1() {

    var sections = document.getElementsByTagName('h2');
    var OL = document.createElement('ol');
    for (var i=0; i < sections.length; ++i) {
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = sections[i].innerHTML;
      if (A.innerHTML.toUpperCase() == 'INDEX') continue;
      A.href = '#' + i;
      LI.appendChild(A);
      OL.appendChild(LI);
      naming(sections[i], i);
      // var PREF = document.createElement('a');
      // PREF.name = i;
      // sections[i].appendChild(PREF);
    }

    return OL;
  }

  function level2() {

    var sections = document.querySelectorAll('h2,h3');
    var tree = [];
    for (var i = 0; i < sections.length; ++i) {
      if (sections[i].tagName == 'H2') {
        if (sections[i].innerHTML.toUpperCase() === 'INDEX') continue;
        tree.push([sections[i]]);
      } else {
        if (tree.length > 0) {
          tree[tree.length-1].push(sections[i]);
        } else {
          tree.push([sections[i]]);
        }
      }
    }

    var OL = document.createElement('ol');
    for (var i = 0; i < tree.length; ++i) {

      // h2-level
      var LI = document.createElement('li');
      var A = document.createElement('a');
      A.innerHTML = tree[i][0].innerHTML;
      A.href = '#' + i;
      naming(tree[i][0], i);
      LI.appendChild(A);

      // h3-level
      if (tree[i].length > 1) {
        var OL_sub = document.createElement('ol');
        for (var j = 1; j < tree[i].length; ++j) {
          var LI_sub = document.createElement('li');
          var A = document.createElement('a');
          A.innerHTML = tree[i][j].innerHTML;
          A.href = `#${i}-${j}`;
          naming(tree[i][j], `${i}-${j}`);
          LI_sub.appendChild(A);
          OL_sub.appendChild(LI_sub);
        }
        LI.appendChild(OL_sub);
      }

      OL.appendChild(LI);
    }

    return OL;
  }

  function append_toc() {
    if (document.getElementById('toc')) {
      document.getElementById('toc').appendChild(level1());
    }
    if (document.getElementById('toc-level-2')) {
      document.getElementById('toc-level-2').appendChild(level2());
    }
  }

  window.addEventListener('DOMContentLoaded', append_toc, false);
}());
</script>
</body>
</html>
